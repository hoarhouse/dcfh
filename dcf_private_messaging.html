<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messages - DCF Hungary</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e5e5e5;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #333;
            text-decoration: none;
        }

        .logo-icon {
            width: 24px;
            height: 24px;
            background: #333;
            border-radius: 50%;
            margin-right: 8px;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-menu a {
            text-decoration: none;
            color: #666;
            font-size: 0.9rem;
            position: relative;
        }

        .nav-menu a.active {
            color: #333;
            font-weight: 600;
        }

        .nav-menu a:hover {
            color: #333;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

       .user-avatar {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #000, #333);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .user-avatar:hover {
            transform: scale(1.05);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .user-menu {
            position: relative;
        }

        .user-dropdown {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            border: 1px solid #e5e5e5;
            min-width: 280px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .dropdown-avatar {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #000, #333);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .dropdown-info {
            flex: 1;
            min-width: 0;
        }

        .dropdown-name {
            font-weight: 600;
            color: #333;
            font-size: 1rem;
            margin-bottom: 0.25rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .dropdown-email {
            color: #666;
            font-size: 0.85rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .dropdown-divider {
            height: 1px;
            background: #f0f0f0;
            margin: 0.5rem 0;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: #333;
            text-decoration: none;
            transition: all 0.2s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .dropdown-item:hover {
            background: #f8f9fa;
            color: #000;
        }

        .logout-btn {
            color: #dc3545 !important;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: #fee !important;
            color: #c82333 !important;
        }

        .dropdown-icon {
            font-size: 1rem;
            width: 20px;
            text-align: center;
            flex-shrink: 0;
        }

        .dropdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 999;
            display: none;
        }

        .dropdown-overlay.active {
            display: block;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            height: calc(100vh - 90px);
        }

        .messaging-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: grid;
            grid-template-columns: 350px 1fr;
            height: 100%;
            overflow: hidden;
        }

        .sidebar {
            border-right: 1px solid #e5e5e5;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e5e5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }

        .new-message-btn {
            background: #000;
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .new-message-btn:hover {
            background: #333;
        }

        .search-container {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e5e5e5;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 0.9rem;
            background: #f8f9fa;
        }

        .search-input:focus {
            outline: none;
            border-color: #333;
            background: white;
        }

        .conversation-list {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem 0;
        }

        .conversation-item {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
        }

        .conversation-item:hover {
            background: #f8f9fa;
        }

        .conversation-item.active {
            background: #f0f0f0;
            border-right: 3px solid #333;
        }

        .conversation-item.unread {
            background: #fffbf0;
        }

        .conversation-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .conversation-info {
            flex: 1;
            min-width: 0;
        }

        .conversation-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.25rem;
        }

        .conversation-preview {
            color: #666;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .conversation-item.unread .conversation-preview {
            font-weight: 600;
            color: #333;
        }

        .conversation-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.25rem;
        }

        .conversation-time {
            color: #999;
            font-size: 0.8rem;
        }

        .unread-badge {
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .online-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 14px;
            height: 14px;
            background: #28a745;
            border-radius: 50%;
            border: 2px solid white;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .chat-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e5e5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            position: relative;
        }

        .chat-user-details {
            flex: 1;
        }

        .chat-user-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.25rem;
        }

        .chat-user-status {
            color: #666;
            font-size: 0.9rem;
        }

        .chat-user-status.online {
            color: #28a745;
        }

        .chat-actions {
            display: flex;
            gap: 0.5rem;
        }

        .chat-action-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .chat-action-btn:hover {
            background: #f8f9fa;
            color: #333;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            max-width: 70%;
        }

        .message.sent {
            margin-left: auto;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .message-content {
            flex: 1;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
        }

        .message-sender {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .message-time {
            color: #999;
            font-size: 0.8rem;
        }

        .message-bubble {
            background: #f8f9fa;
            border: 1px solid #e5e5e5;
            border-radius: 12px;
            padding: 0.75rem 1rem;
            color: #333;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .message.sent .message-bubble {
            background: #000;
            color: white;
            border-color: #000;
        }

        .message-reactions {
            display: flex;
            gap: 0.25rem;
            margin-top: 0.5rem;
        }

        .reaction {
            background: #f8f9fa;
            border: 1px solid #e5e5e5;
            border-radius: 12px;
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reaction:hover {
            background: #e9ecef;
        }

        .reaction.active {
            background: #333;
            color: white;
            border-color: #333;
        }

        .message-input-container {
            padding: 1rem;
            border-top: 1px solid #e5e5e5;
            background: #f8f9fa;
        }

        .message-input-wrapper {
            display: flex;
            align-items: flex-end;
            gap: 0.75rem;
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 12px;
            padding: 0.75rem;
            transition: border-color 0.3s ease;
        }

        .message-input-wrapper:focus-within {
            border-color: #333;
        }

        .message-input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 1rem;
            font-family: inherit;
            resize: none;
            min-height: 20px;
            max-height: 100px;
            line-height: 1.4;
        }

        .message-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .message-action-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .message-action-btn:hover {
            background: #f8f9fa;
            color: #333;
        }

        .send-btn {
            background: #000;
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .send-btn:hover {
            background: #333;
        }

        .send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #666;
            text-align: center;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .empty-state-description {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #666;
        }

        .typing-dots {
            display: flex;
            gap: 0.25rem;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #999;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #333;
        }

        .textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 1rem;
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .textarea:focus {
            outline: none;
            border-color: #333;
        }

        .member-search-results {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            margin-top: 0.5rem;
        }

        .member-result {
            padding: 0.75rem;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: background-color 0.3s ease;
        }

        .member-result:hover {
            background: #f8f9fa;
        }

        .member-result:last-child {
            border-bottom: none;
        }

        .member-result-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .member-result-info {
            flex: 1;
        }

        .member-result-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.25rem;
        }

        .member-result-role {
            color: #666;
            font-size: 0.9rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .btn-primary {
            background: #000;
            color: white;
        }

        .btn-primary:hover {
            background: #333;
        }

        .btn-secondary {
            background: transparent;
            color: #666;
            border: 2px solid #e5e5e5;
        }

        .btn-secondary:hover {
            color: #333;
            border-color: #333;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        @media (max-width: 1024px) {
            .messaging-container {
                grid-template-columns: 280px 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 1rem;
            }

            .messaging-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }

            .sidebar {
                border-right: none;
                border-bottom: 1px solid #e5e5e5;
                height: auto;
                max-height: 300px;
            }

            .chat-container {
                min-height: 0;
            }

            .nav-menu {
                display: none;
            }

            .message {
                max-width: 85%;
            }

            .sidebar-header {
                padding: 1rem;
            }

            .conversation-list {
                max-height: 200px;
            }
        }
    </style>
<script src="universal-navbar.js"></script>
</head>

<body>
    <header class="header">
        <nav class="nav-container">
            <a href="index.html" class="logo">
                <div class="logo-icon"></div>
                Domus Communis Foundation
            </a>
            <ul class="nav-menu" id="navMenu">
            </ul>
            <div class="user-menu">
    <div class="user-dropdown">
        <div class="user-avatar" onclick="toggleUserMenu()" id="userAvatar"></div>        <div class="dropdown-menu" id="userDropdown">
            <div class="dropdown-header">
                <div class="dropdown-avatar"></div>
                <div class="dropdown-info">
                    <div class="dropdown-name" id="dropdownUserName"></div>
                    <div class="dropdown-email" id="dropdownUserEmail"></div>
                </div>
            </div>
            <div class="dropdown-divider"></div>
            <!-- Navigation will be dynamically generated by dcf-master-consolidated.js -->
        </div>
    </div>
</div>
        </nav>
    </header>

    <main class="main-container">
        <div class="messaging-container">
            <div class="sidebar">
                <div class="sidebar-header">
                    <h1 class="sidebar-title">Messages</h1>
                    <button class="new-message-btn" onclick="openNewMessageModal()" title="New Message">+</button>
                </div>

                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Search conversations..." id="conversationSearch">
                </div>

                <div class="conversation-list" id="conversationList">
                    <div class="conversation-item unread active" data-conversation="mary-aiken">
                        <div class="conversation-avatar">MA</div>
                        <div class="conversation-info">
                            <div class="conversation-name">Dr. Mary Aiken</div>
                            <div class="conversation-preview">Thanks for sharing the child safety research. Let's discuss the implications for our upcoming workshop.</div>
                        </div>
                        <div class="conversation-meta">
                            <div class="conversation-time">2 min ago</div>
                            <div class="unread-badge">2</div>
                        </div>
                        <div class="online-indicator"></div>
                    </div>

                    <div class="conversation-item" data-conversation="michael-torres">
                        <div class="conversation-avatar">MT</div>
                        <div class="conversation-info">
                            <div class="conversation-name">Fr. Michael Torres</div>
                            <div class="conversation-preview">The theological framework document is ready for review. Would you like to schedule a call to discuss?</div>
                        </div>
                        <div class="conversation-meta">
                            <div class="conversation-time">1 hour ago</div>
                        </div>
                    </div>

                    <div class="conversation-item" data-conversation="antal-kuthy">
                        <div class="conversation-avatar">AK</div>
                        <div class="conversation-info">
                            <div class="conversation-name">Dr. Antal Kuthy</div>
                            <div class="conversation-preview">Great presentation at the conference! The AI governance section was particularly insightful.</div>
                        </div>
                        <div class="conversation-meta">
                            <div class="conversation-time">3 hours ago</div>
                        </div>
                        <div class="online-indicator"></div>
                    </div>

                    <div class="conversation-item" data-conversation="alessio-pecorario">
                        <div class="conversation-avatar">AP</div>
                        <div class="conversation-info">
                            <div class="conversation-name">Dr. Alessio Pecorario</div>
                            <div class="conversation-preview">The EU AI Act compliance guide is now available. I've updated the resource library with the latest version.</div>
                        </div>
                        <div class="conversation-meta">
                            <div class="conversation-time">Yesterday</div>
                        </div>
                    </div>

                    <div class="conversation-item unread" data-conversation="project-team">
                        <div class="conversation-avatar">PT</div>
                        <div class="conversation-info">
                            <div class="conversation-name">AI Ethics Project Team</div>
                            <div class="conversation-preview">New milestone completed! Check out the updated project dashboard for the latest progress.</div>
                        </div>
                        <div class="conversation-meta">
                            <div class="conversation-time">Yesterday</div>
                            <div class="unread-badge">1</div>
                        </div>
                    </div>

                    <div class="conversation-item" data-conversation="greg-sim">
                        <div class="conversation-avatar">GS</div>
                        <div class="conversation-info">
                            <div class="conversation-name">Greg Sim</div>
                            <div class="conversation-preview">Looking forward to our collaboration on the cybersecurity framework. When would be a good time to connect?</div>
                        </div>
                        <div class="conversation-meta">
                            <div class="conversation-time">2 days ago</div>
                        </div>
                    </div>

                    <div class="conversation-item" data-conversation="zoltan-papp">
                        <div class="conversation-avatar">ZP</div>
                        <div class="conversation-info">
                            <div class="conversation-name">Zoltan Papp</div>
                            <div class="conversation-preview">The patent application for the new AI safety protocol has been submitted. I'll keep you updated on the progress.</div>
                        </div>
                        <div class="conversation-meta">
                            <div class="conversation-time">1 week ago</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chat-container" id="chatContainer">
                <div class="chat-header">
                    <div class="chat-user-info">
                        <div class="chat-avatar">
                            MA
                            <div class="online-indicator"></div>
                        </div>
                        <div class="chat-user-details">
                            <div class="chat-user-name">Dr. Mary Aiken</div>
                            <div class="chat-user-status online">Online • Active now</div>
                        </div>
                    </div>
                    <div class="chat-actions">
                        <button class="chat-action-btn" onclick="startVideoCall()" title="Video Call">📹</button>
                        <button class="chat-action-btn" onclick="startVoiceCall()" title="Voice Call">📞</button>
                        <button class="chat-action-btn" onclick="openChatInfo()" title="Chat Info">ℹ️</button>
                    </div>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <div class="message">
                        <div class="message-avatar">MA</div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-sender">Dr. Mary Aiken</div>
                                <div class="message-time">Today at 2:15 PM</div>
                            </div>
                            <div class="message-bubble">
                                Hi Sarah! I hope you're doing well. I wanted to follow up on our discussion about child safety in AI systems. Have you had a chance to review the research paper I sent?
                            </div>
                        </div>
                    </div>

                    <div class="message sent">
                        <div class="message-avatar">SJ</div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-sender">You</div>
                                <div class="message-time">Today at 2:18 PM</div>
                            </div>
                            <div class="message-bubble">
                                Hi Mary! Yes, I've reviewed it thoroughly. The findings about age-appropriate AI interactions are fascinating. I think this could be a cornerstone for our upcoming workshop on ethical AI development.
                            </div>
                        </div>
                    </div>

                    <div class="message">
                        <div class="message-avatar">MA</div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-sender">Dr. Mary Aiken</div>
                                <div class="message-time">Today at 2:20 PM</div>
                            </div>
                            <div class="message-bubble">
                                I'm so glad you found it valuable! The section on developmental psychology and AI interaction patterns took months to research. Would you be interested in co-presenting this at the workshop?
                            </div>
                            <div class="message-reactions">
                                <div class="reaction">👍 2</div>
                                <div class="reaction">❤️ 1</div>
                            </div>
                        </div>
                    </div>

                    <div class="message sent">
                        <div class="message-avatar">SJ</div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-sender">You</div>
                                <div class="message-time">Today at 2:22 PM</div>
                            </div>
                            <div class="message-bubble">
                                Absolutely! I'd love to co-present with you. We could structure it as a dialogue between cyberpsychology and AI ethics perspectives. What do you think?
                            </div>
                        </div>
                    </div>

                    <div class="message">
                        <div class="message-avatar">MA</div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-sender">Dr. Mary Aiken</div>
                                <div class="message-time">Today at 2:25 PM</div>
                            </div>
                            <div class="message-bubble">
                                That's a brilliant approach! The interdisciplinary perspective will be so valuable for our audience. Should we schedule a call this week to outline the presentation structure?
                            </div>
                        </div>
                    </div>

                    <div class="typing-indicator" id="typingIndicator" style="display: none;">
                        <span>Dr. Mary Aiken is typing</span>
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>

                <div class="message-input-container">
                    <div class="message-input-wrapper">
                        <div class="message-actions">
                            <button class="message-action-btn" onclick="attachFile()" title="Attach File">📎</button>
                            <button class="message-action-btn" onclick="addEmoji()" title="Add Emoji">😊</button>
                        </div>
                        <textarea class="message-input" placeholder="Type your message..." id="messageInput" rows="1"></textarea>
                        <button class="send-btn" onclick="sendMessage()" id="sendButton" disabled>→</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- New Message Modal -->
    <div class="modal" id="newMessageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">New Message</h2>
                <button class="close-btn" onclick="closeModal('newMessageModal')">&times;</button>
            </div>
            <form id="newMessageForm">
                <div class="form-group">
                    <label class="form-label" for="recipientSearch">To:</label>
                    <input type="text" id="recipientSearch" class="form-input" placeholder="Search for a member to message...">
                    <div class="member-search-results" id="memberSearchResults" style="display: none;"></div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="messageSubject">Subject (Optional):</label>
                    <input type="text" id="messageSubject" class="form-input" placeholder="Enter message subject...">
                </div>
                <div class="form-group">
                    <label class="form-label" for="newMessageText">Message:</label>
                    <textarea id="newMessageText" class="textarea" placeholder="Type your message..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('newMessageModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Send Message</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let currentConversation = 'mary-aiken';
        let conversations = {};
        let isTyping = false;

        // Sample members data
        const members = [
            { id: 'mary-aiken', name: 'Dr. Mary Aiken', role: 'Cyberpsychologist', avatar: 'MA' },
            { id: 'michael-torres', name: 'Fr. Michael Torres', role: 'Theologian', avatar: 'MT' },
            { id: 'antal-kuthy', name: 'Dr. Antal Kuthy', role: 'AI Technology Director', avatar: 'AK' },
            { id: 'alessio-pecorario', name: 'Dr. Alessio Pecorario', role: 'Policy Analyst', avatar: 'AP' },
            { id: 'greg-sim', name: 'Greg Sim', role: 'Cybersecurity Expert', avatar: 'GS' },
            { id: 'zoltan-papp', name: 'Zoltan Papp', role: 'Technology Advisor', avatar: 'ZP' }
        ];

        // Initialize messaging
        document.addEventListener('DOMContentLoaded', function() {
            setupMessageInput();
            setupConversationSearch();
            setupConversationListeners();
            loadConversation(currentConversation);
        });

        function setupMessageInput() {
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');

            messageInput.addEventListener('input', function() {
                // Auto-resize textarea
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 100) + 'px';
                
                // Enable/disable send button
                sendButton.disabled = !this.value.trim();
                
                // Show typing indicator
                if (!isTyping && this.value.trim()) {
                    isTyping = true;
                    // In a real app, this would send typing status to other users
                }
            });

            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        }

        function setupConversationSearch() {
            const searchInput = document.getElementById('conversationSearch');
            searchInput.addEventListener('input', function() {
                filterConversations(this.value);
            });
        }

        function setupConversationListeners() {
            document.querySelectorAll('.conversation-item').forEach(item => {
                item.addEventListener('click', function() {
                    const conversationId = this.dataset.conversation;
                    selectConversation(conversationId);
                });
            });
        }

        function selectConversation(conversationId) {
            // Update active conversation
            document.querySelectorAll('.conversation-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-conversation="${conversationId}"]`).classList.add('active');
            
            // Mark as read
            const conversationItem = document.querySelector(`[data-conversation="${conversationId}"]`);
            conversationItem.classList.remove('unread');
            const unreadBadge = conversationItem.querySelector('.unread-badge');
            if (unreadBadge) {
                unreadBadge.remove();
            }
            
            currentConversation = conversationId;
            loadConversation(conversationId);
        }

        function loadConversation(conversationId) {
            const member = members.find(m => m.id === conversationId);
            if (!member) return;

            // Update chat header
            document.querySelector('.chat-user-name').textContent = member.name;
            document.querySelector('.chat-avatar').textContent = member.avatar;
            
            // Update online status (randomly for demo)
            const statusElement = document.querySelector('.chat-user-status');
            const isOnline = Math.random() > 0.5;
            statusElement.textContent = isOnline ? 'Online • Active now' : 'Last seen 2 hours ago';
            statusElement.className = isOnline ? 'chat-user-status online' : 'chat-user-status';
            
            // Load messages for this conversation
            loadMessages(conversationId);
        }

        function loadMessages(conversationId) {
            const messagesContainer = document.getElementById('chatMessages');
            
            // Sample messages based on conversation
            const sampleMessages = {
                'mary-aiken': [
                    { sender: 'mary-aiken', text: 'Hi Sarah! I hope you\'re doing well. I wanted to follow up on our discussion about child safety in AI systems. Have you had a chance to review the research paper I sent?', time: 'Today at 2:15 PM' },
                    { sender: 'self', text: 'Hi Mary! Yes, I\'ve reviewed it thoroughly. The findings about age-appropriate AI interactions are fascinating. I think this could be a cornerstone for our upcoming workshop on ethical AI development.', time: 'Today at 2:18 PM' },
                    { sender: 'mary-aiken', text: 'I\'m so glad you found it valuable! The section on developmental psychology and AI interaction patterns took months to research. Would you be interested in co-presenting this at the workshop?', time: 'Today at 2:20 PM' },
                    { sender: 'self', text: 'Absolutely! I\'d love to co-present with you. We could structure it as a dialogue between cyberpsychology and AI ethics perspectives. What do you think?', time: 'Today at 2:22 PM' },
                    { sender: 'mary-aiken', text: 'That\'s a brilliant approach! The interdisciplinary perspective will be so valuable for our audience. Should we schedule a call this week to outline the presentation structure?', time: 'Today at 2:25 PM' }
                ],
                'michael-torres': [
                    { sender: 'michael-torres', text: 'Good morning, Sarah. I\'ve been working on the theological framework for AI ethics that we discussed. The integration of Catholic Social Teaching principles is coming along well.', time: 'Yesterday at 9:30 AM' },
                    { sender: 'self', text: 'That\'s wonderful, Michael! I\'m eager to see how you\'ve structured the theological foundations. This will be crucial for our institutional guidelines.', time: 'Yesterday at 10:15 AM' },
                    { sender: 'michael-torres', text: 'The document is ready for review. Would you like to schedule a call to discuss the implementation strategy?', time: '1 hour ago' }
                ]
            };

            // Clear existing messages
            messagesContainer.innerHTML = '';

            // Load messages for this conversation
            const messages = sampleMessages[conversationId] || [];
            messages.forEach(message => {
                addMessageToChat(message);
            });

            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function addMessageToChat(message) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageElement = document.createElement('div');
            messageElement.className = `message ${message.sender === 'self' ? 'sent' : ''}`;
            
            const member = members.find(m => m.id === message.sender);
            const avatar = message.sender === 'self' ? 'SJ' : (member ? member.avatar : 'U');
            const senderName = message.sender === 'self' ? 'You' : (member ? member.name : 'Unknown');
            
            messageElement.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    <div class="message-header">
                        <div class="message-sender">${senderName}</div>
                        <div class="message-time">${message.time}</div>
                    </div>
                    <div class="message-bubble">${message.text}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const messageText = messageInput.value.trim();
            
            if (!messageText) return;

            // Add message to chat
            const now = new Date();
            const timeString = `Today at ${now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
            
            addMessageToChat({
                sender: 'self',
                text: messageText,
                time: timeString
            });

            // Clear input
            messageInput.value = '';
            messageInput.style.height = 'auto';
            document.getElementById('sendButton').disabled = true;
            
            // Update conversation preview
            updateConversationPreview(currentConversation, messageText);
            
            // Simulate typing response after a delay
            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    hideTypingIndicator();
                    simulateResponse();
                }, 2000);
            }, 1000);
        }

        function simulateResponse() {
            const responses = [
                "That's a great point! I hadn't considered that perspective.",
                "Thanks for sharing that insight. It really adds to our discussion.",
                "I agree completely. Let's explore this further in our next meeting.",
                "Excellent idea! I'll incorporate that into our framework.",
                "Thank you for the clarification. This helps me understand better."
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            const now = new Date();
            const timeString = `Today at ${now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
            
            addMessageToChat({
                sender: currentConversation,
                text: randomResponse,
                time: timeString
            });
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'flex';
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function updateConversationPreview(conversationId, messageText) {
            const conversationItem = document.querySelector(`[data-conversation="${conversationId}"]`);
            const preview = conversationItem.querySelector('.conversation-preview');
            const time = conversationItem.querySelector('.conversation-time');
            
            preview.textContent = messageText;
            time.textContent = 'Just now';
            
            // Move conversation to top
            const conversationList = document.getElementById('conversationList');
            conversationList.insertBefore(conversationItem, conversationList.firstChild);
        }

        function filterConversations(searchTerm) {
            const conversations = document.querySelectorAll('.conversation-item');
            conversations.forEach(conversation => {
                const name = conversation.querySelector('.conversation-name').textContent.toLowerCase();
                const preview = conversation.querySelector('.conversation-preview').textContent.toLowerCase();
                const matches = name.includes(searchTerm.toLowerCase()) || preview.includes(searchTerm.toLowerCase());
                conversation.style.display = matches ? 'flex' : 'none';
            });
        }

        // New message functionality
        function openNewMessageModal() {
            document.getElementById('newMessageModal').classList.add('active');
            setupMemberSearch();
        }

        function setupMemberSearch() {
            const searchInput = document.getElementById('recipientSearch');
            const resultsContainer = document.getElementById('memberSearchResults');
            
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                if (searchTerm.length > 0) {
                    const filteredMembers = members.filter(member => 
                        member.name.toLowerCase().includes(searchTerm) || 
                        member.role.toLowerCase().includes(searchTerm)
                    );
                    
                    if (filteredMembers.length > 0) {
                        resultsContainer.innerHTML = filteredMembers.map(member => `
                            <div class="member-result" onclick="selectRecipient('${member.id}', '${member.name}')">
                                <div class="member-result-avatar">${member.avatar}</div>
                                <div class="member-result-info">
                                    <div class="member-result-name">${member.name}</div>
                                    <div class="member-result-role">${member.role}</div>
                                </div>
                            </div>
                        `).join('');
                        resultsContainer.style.display = 'block';
                    } else {
                        resultsContainer.style.display = 'none';
                    }
                } else {
                    resultsContainer.style.display = 'none';
                }
            });
        }

        function selectRecipient(memberId, memberName) {
            document.getElementById('recipientSearch').value = memberName;
            document.getElementById('memberSearchResults').style.display = 'none';
            document.getElementById('recipientSearch').dataset.memberId = memberId;
        }

        // Chat actions
        function startVideoCall() {
            alert('Video call functionality would be implemented here');
        }

        function startVoiceCall() {
            alert('Voice call functionality would be implemented here');
        }

        function openChatInfo() {
            alert('Chat information panel would be implemented here');
        }

        function attachFile() {
            alert('File attachment functionality would be implemented here');
        }

        function addEmoji() {
            alert('Emoji picker would be implemented here');
        }

        // Modal functions
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Form submissions
        document.getElementById('newMessageForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const recipientId = document.getElementById('recipientSearch').dataset.memberId;
            const subject = document.getElementById('messageSubject').value;
            const messageText = document.getElementById('newMessageText').value;
            
            if (!recipientId || !messageText.trim()) {
                alert('Please select a recipient and enter a message');
                return;
            }
            
            // Create new conversation or navigate to existing one
            selectConversation(recipientId);
            
            // Send the message
            setTimeout(() => {
                const now = new Date();
                const timeString = `Today at ${now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
                
                addMessageToChat({
                    sender: 'self',
                    text: messageText,
                    time: timeString
                });
                
                updateConversationPreview(recipientId, messageText);
            }, 500);
            
            closeModal('newMessageModal');
            
            // Reset form
            document.getElementById('newMessageForm').reset();
            document.getElementById('memberSearchResults').style.display = 'none';
        });

        // Close modals when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal(this.id);
                }
            });
   });

        // User menu functionality
        let isDropdownOpen = false;

        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            const overlay = getOrCreateOverlay();
            
            if (isDropdownOpen) {
                closeUserMenu();
            } else {
                openUserMenu();
            }
        }

        function openUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            const overlay = getOrCreateOverlay();
            
            dropdown.classList.add('active');
            overlay.classList.add('active');
            isDropdownOpen = true;
            
            // updateUserDropdownInfo(); - removed, handled by master JS
        }

        function closeUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            const overlay = document.querySelector('.dropdown-overlay');
            
            dropdown.classList.remove('active');
            if (overlay) overlay.classList.remove('active');
            isDropdownOpen = false;
        }

        function getOrCreateOverlay() {
            let overlay = document.querySelector('.dropdown-overlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.className = 'dropdown-overlay';
                overlay.onclick = closeUserMenu;
                document.body.appendChild(overlay);
            }
            return overlay;
        }

        // updateUserDropdownInfo function removed - handled by master JS

        function generateInitials(name) {
            if (!name) return 'SJ';
            const parts = name.split(' ');
            if (parts.length >= 2) {
                return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
            }
            return name.substring(0, 2).toUpperCase();
        }

        function logout() {
            if (confirm('Are you sure you want to sign out?')) {
                localStorage.removeItem('dcf_github_session');
                localStorage.removeItem('dcf_user_logged_in');
                localStorage.removeItem('dcf_user_name');
                localStorage.removeItem('dcf_user_email');
                localStorage.removeItem('dcf_auth_provider');
                localStorage.removeItem('dcf_remember_login');

                sessionStorage.clear();

                alert('You have been signed out successfully.');
                window.location.href = 'dcf_login_page.html';
            }
        }

        // Initialize user menu on page load
        document.addEventListener('DOMContentLoaded', function() {
            // updateUserDropdownInfo(); - removed, handled by master JS

            // Check if user is logged in
            const isLoggedIn = localStorage.getItem('dcf_user_logged_in');
            if (isLoggedIn !== 'true') {
                // DISABLED: alert('Please log in to access member pages.');
                window.location.href = 'dcf_login_page.html';
            }

            // Close dropdown on escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && isDropdownOpen) {
                    closeUserMenu();
                }
            });
        });
    </script>
</body>
</html>