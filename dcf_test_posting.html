<!DOCTYPE html>
<html>
<head>
    <title>CDN Debug</title>
</head>
<body>
    <h1>CDN Debug Test</h1>
    <div id="output"></div>
    
    <script>
        function log(msg) {
            document.getElementById('output').innerHTML += '<p>' + msg + '</p>';
            console.log(msg);
        }
        
        log('Starting CDN test...');
        
        // Check what's on window before loading
        log('Window keys before: ' + Object.keys(window).length);
        
        // Load multiple CDN versions and see which one works
        const cdnUrls = [
            'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1.35.7/dist/umd/supabase.min.js',
            'https://unpkg.com/@supabase/supabase-js@1/dist/umd/supabase.min.js',
            'https://cdnjs.cloudflare.com/ajax/libs/supabase/1.35.7/supabase.min.js'
        ];
        
        function testCDN(url, index) {
            return new Promise((resolve) => {
                const script = document.createElement('script');
                script.src = url;
                script.onload = () => {
                    log(`CDN ${index + 1} LOADED: ${url}`);
                    log('Window.supabase: ' + typeof window.supabase);
                    log('Window.Supabase: ' + typeof window.Supabase);
                    
                    if (window.supabase || window.Supabase) {
                        log(`SUCCESS: CDN ${index + 1} has Supabase!`);
                        resolve(true);
                    } else {
                        log(`FAIL: CDN ${index + 1} loaded but no Supabase object`);
                        resolve(false);
                    }
                };
                script.onerror = () => {
                    log(`ERROR: CDN ${index + 1} failed to load: ${url}`);
                    resolve(false);
                };
                document.head.appendChild(script);
            });
        }
        
        async function testAllCDNs() {
            for (let i = 0; i < cdnUrls.length; i++) {
                log(`Testing CDN ${i + 1}...`);
                const success = await testCDN(cdnUrls[i], i);
                if (success) {
                    log('FOUND WORKING CDN!');
                    break;
                }
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            log('Final window inspection:');
            const supaKeys = Object.keys(window).filter(key => 
                key.toLowerCase().includes('supa') || 
                key.toLowerCase().includes('client') ||
                key.toLowerCase().includes('base')
            );
            log('Relevant keys: ' + JSON.stringify(supaKeys));
        }
        
        testAllCDNs();
    </script>
</body>
</html>