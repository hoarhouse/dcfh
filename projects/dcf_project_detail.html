<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCF Hungary</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='40' fill='%23dc3545'/></svg>">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../js/dcf-unified-auth.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e5e5e5;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #333;
            text-decoration: none;
        }

        .logo-icon {
            width: 24px;
            height: 24px;
            background: #333;
            border-radius: 50%;
            margin-right: 8px;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-menu a {
            text-decoration: none;
            color: #666;
            font-size: 0.9rem;
            position: relative;
        }

        .nav-menu a.active {
            color: #333;
            font-weight: 600;
        }

        .nav-menu a:hover {
            color: #333;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-menu {
            position: relative;
        }

        .user-dropdown {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            border: 1px solid #e5e5e5;
            min-width: 280px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f0f0;
            color: #666;
            font-weight: 600;
            font-size: 0.75rem;
            transition: all 0.2s ease;
            box-sizing: border-box;
            overflow: hidden;
        }

        .user-avatar:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .dropdown-avatar {
            width: 48px;
            height: 48px;
            min-width: 48px;
            min-height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #000, #333);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            flex-shrink: 0;
            box-sizing: border-box;
            overflow: hidden;
        }

        .dropdown-info {
            flex: 1;
            min-width: 0;
        }

        .dropdown-name {
            font-weight: 600;
            color: #333;
            font-size: 1rem;
            margin-bottom: 0.25rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .dropdown-email {
            color: #666;
            font-size: 0.85rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .dropdown-divider {
            height: 1px;
            background: #f0f0f0;
            margin: 0.5rem 0;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: #333;
            text-decoration: none;
            transition: all 0.2s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .dropdown-item:hover {
            background: #f8f9fa;
            color: #000;
        }

        .logout-btn {
            color: #dc3545 !important;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: #fee !important;
            color: #c82333 !important;
        }

        .dropdown-icon {
            font-size: 1rem;
            width: 20px;
            text-align: center;
            flex-shrink: 0;
        }

        .dropdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 999;
            display: none;
        }

        .dropdown-overlay.active {
            display: block;
        }

        /* Project Cover Photo */
        .project-hero {
            position: relative;
            height: 350px;
            margin-bottom: 2rem;
            border-radius: 16px;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        /* Edit Cover Button */
        .edit-cover-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 10; /* Increased z-index */
            padding: 0.75rem 1.25rem;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            pointer-events: auto; /* Ensure pointer events work */
        }
        
        .edit-cover-btn:hover {
            background: rgba(0, 0, 0, 0.95);
            border-color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        /* Owner Controls */
        .owner-controls {
            margin-top: 1.5rem;
            display: flex;
            gap: 1rem;
        }
        
        .manage-project-btn {
            padding: 0.75rem 1.5rem;
            background: white;
            color: #333;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .manage-project-btn:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        /* Cover Edit Modal */
        .cover-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .cover-modal.active {
            display: flex;
        }
        
        .cover-modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .cover-modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e5e5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .cover-modal-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .cover-modal-body {
            padding: 2rem;
        }
        
        .upload-area {
            border: 2px dashed #e5e5e5;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .upload-area:hover {
            border-color: #333;
            background: #f8f9fa;
        }
        
        .upload-placeholder {
            width: 100%;
        }
        
        .image-preview {
            width: 100%;
            height: auto;
            border-radius: 8px;
            display: none;
        }
        
        .cover-modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e5e5e5;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        .btn-cancel {
            padding: 0.75rem 1.5rem;
            background: #f8f9fa;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .btn-save {
            padding: 0.75rem 1.5rem;
            background: #333;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .btn-save:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .btn-save:not(:disabled):hover {
            background: #000;
        }

        .hero-background {
            position: absolute;
            inset: 0;
            background-size: cover;
            background-position: center;
            z-index: 1;
        }

        .hero-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.2));
            z-index: 2;
        }

        .hero-content {
            position: relative;
            z-index: 3;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: white;
            text-align: center;
        }

        .hero-title {
            font-size: 3rem;
            font-weight: 800;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            margin: 0 0 1rem 0;
        }

        .hero-subtitle {
            font-size: 1.3rem;
            font-weight: 500;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
            opacity: 0.9;
            max-width: 600px;
            margin: 0;
            line-height: 1.4;
        }

        /* About Section Styling */
        .about-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .about-title {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 0.5rem;
            margin-top: 0;
        }
        
        .project-url-link {
            display: inline-block;
            font-size: 1rem;
            color: #0066cc;
            text-decoration: none;
            margin-bottom: 1.5rem;
            transition: color 0.3s ease;
        }
        
        .project-url-link:hover {
            color: #0052a3;
            text-decoration: underline;
        }

        .project-website-link {
            display: inline-block;
            margin: 1rem 0 1.5rem 0;
            color: #007bff;
            text-decoration: none;
            font-size: 1.35rem;
            font-weight: 500;
        }

        .project-website-link:hover {
            color: #0056b3;
            text-decoration: underline;
        }
        
        /* Like/Share Button Styles */
        .interaction-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            color: #666;
        }

        .interaction-btn:hover {
            border-color: #333;
            color: #333;
        }

        .interaction-btn.active {
            background: #ff4757;
            color: white;
            border-color: #ff4757;
        }

        .share-dropdown {
            position: relative;
        }

        .share-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 0.5rem;
            min-width: 200px;
            z-index: 10;
            display: none;
        }

        .share-menu.active {
            display: block;
        }

        .share-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .share-item:hover {
            background: #f8f9fa;
        }
        
        /* Related Projects Card */
        .related-projects-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .related-project-item {
            padding: 1rem;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .related-project-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-color: #333;
        }
        
        .related-project-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .related-project-desc {
            font-size: 0.85rem;
            color: #666;
            line-height: 1.4;
        }
        
        .related-projects-more-btn {
            width: 100%;
            padding: 0.75rem 1.5rem;
            margin-top: 1rem;
            background: #333;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .related-projects-more-btn:hover {
            background: #000;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .about-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            align-items: start;
        }
        
        .right-column {
            position: sticky;
            top: 1rem;
            max-height: 90vh;
            overflow-y: auto;
        }

        .about-description {
            color: #666;
            line-height: 1.7;
            font-size: 1.1rem;
        }

        .description-more {
            color: #007bff;
            font-style: italic;
            cursor: pointer;
            text-decoration: underline;
        }

        .description-more:hover {
            color: #0056b3;
        }

        .author-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
        }

        .author-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .author-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #000, #333);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .author-info {
            flex: 1;
            min-width: 0;
        }

        .author-name {
            font-weight: 600;
            color: #333;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .author-title {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .author-email {
            color: #666;
            font-size: 0.8rem;
            text-decoration: none;
        }

        .author-email:hover {
            color: #333;
        }

        .author-label {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        /* Stats Section Styling */
        .stats-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .stats-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            text-align: center;
            padding: 1rem 0.5rem;
            background: #f8f9fa;
            border-radius: 8px;
            transition: all 0.3s ease;
            min-width: 0;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 800;
            color: #333;
            margin-bottom: 0.25rem;
            line-height: 1;
        }

        .stat-label {
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            font-weight: 600;
            line-height: 1.2;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }
            
            .stat-card {
                padding: 0.75rem 0.25rem;
            }
            
            .stat-number {
                font-size: 1.2rem;
            }
            
            .stat-label {
                font-size: 0.6rem;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .join-project-card {
            background: linear-gradient(135deg, #000, #333);
            color: white;
            text-align: center;
            padding: 2rem;
            border-radius: 12px;
            margin-top: 2rem;
        }

        .join-project-card h3 {
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .join-project-card p {
            margin-bottom: 1.5rem;
            opacity: 0.9;
            line-height: 1.6;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .join-project-card .btn {
            background: white;
            color: #000;
        }

        .join-project-card .btn:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
        }
        
        .join-project-card .manage-btn-stats {
            background: #dc3545;
            color: white;
            margin-left: 1rem;
        }
        
        .join-project-card .manage-btn-stats:hover {
            background: #c82333;
        }

        /* Project Feed Section */
        .project-feed-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .feed-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 1.5rem;
        }

        /* Post Creation Box */
        .create-post-box {
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            transition: border-color 0.3s ease;
        }

        .create-post-box:focus-within {
            border-color: #333;
        }

        .post-composer {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .composer-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #000, #333);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .composer-textarea {
            width: 100%;
            min-height: 100px;
            border: none;
            outline: none;
            resize: vertical;
            font-family: inherit;
            font-size: 1rem;
            line-height: 1.5;
            background: transparent;
            padding: 10px;
        }

        .composer-textarea::placeholder {
            color: #999;
        }

        .composer-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid #f0f0f0;
        }

        .upload-buttons {
            display: flex;
            gap: 1rem;
        }

        .upload-btn {
            background: #f8f9fa;
            border: 1px solid #e5e5e5;
            border-radius: 6px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            background: #e9ecef;
            border-color: #333;
        }

        .post-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .character-count {
            color: #666;
            font-size: 0.8rem;
        }

        .post-btn {
            background: #333;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 0.6rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .post-btn:hover {
            background: #000;
        }

        .post-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .main-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
            min-height: calc(100vh - 200px);
        }

        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }
            
            .project-hero {
                height: 300px;
            }
            
            .hero-content {
                flex-direction: column;
                align-items: center;
                text-align: center;
                padding: 2rem;
                gap: 1rem;
            }

            .hero-title {
                font-size: 2rem !important;
            }

            .hero-subtitle {
                font-size: 1rem !important;
            }
            
            .main-container {
                padding: 0 1rem;
            }

            .about-content {
                grid-template-columns: 1fr;
            }

            /* Two column layout becomes single column on mobile */
            .main-container > div[style*="grid-template-columns"] {
                display: block !important;
            }

            .main-container > div[style*="grid-template-columns"] > div:first-child {
                margin-bottom: 2rem;
            }
        }
    </style>
</head>

<body>
    <header class="header">
        <nav class="nav-container">
            <a href="../index.html" class="logo">
                <div class="logo-icon"></div>
                Domus Communis Foundation
            </a>
             <ul class="nav-menu" id="navMenu">
                <!-- Navigation populated by dcf-unified-auth.js -->
            </ul>
            <div class="user-menu">
                <div class="user-dropdown">
                    <div class="user-avatar" onclick="toggleUserMenu()" id="userAvatar"></div>
                    <div class="dropdown-menu" id="userDropdown">
                        <div class="dropdown-header">
                            <div class="dropdown-avatar"></div>
                            <div class="dropdown-info">
                                <div class="dropdown-name" id="dropdownUserName"></div>
                                <div class="dropdown-email" id="dropdownUserEmail"></div>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="main-container">
        <!-- Project Cover Photo with Overlay -->
        <div class="project-hero" id="projectHero">
            <div class="hero-background" id="heroBackground"></div>
            <div class="hero-overlay"></div>
            
            <!-- Edit Cover Button (hidden by default) -->
            <button type="button" class="edit-cover-btn" id="editCoverBtn" style="display: none;">
                <span>üì∑</span> Edit Cover
            </button>
            
            <div class="hero-content">
                <h1 class="hero-title" id="heroTitle">Title Goes Here</h1>
                <p class="hero-subtitle" id="heroSubtitle">Project Goal Goes Here</p>
                <a href="#" class="project-website-link" id="projectWebsiteLink" target="_blank" style="display: none; color: white; margin-top: 1rem;">Visit Project Website</a>
                
                <!-- Owner Controls -->
                <div class="owner-controls" id="ownerControls" style="display: none;">
                    <button class="manage-project-btn" onclick="manageProject()">
                        <span>‚öôÔ∏è</span> Manage Project
                    </button>
                </div>
            </div>
        </div>

        <!-- About Section -->
        <div class="about-section" id="aboutSection">
            <div class="about-content">
                <!-- Left Column -->
                <div>
                    <h2 class="about-title" id="aboutTitle">About This Project</h2>
                    <a href="#" class="project-url-link" id="projectUrlLink" target="_blank" style="display: none;">Visit Project Website</a>
                    <div class="about-description" id="aboutDescription">
                        <p>Project description will appear here. This section provides detailed information about the project's goals, mission, and impact.</p>
                        
                        <!-- Like/Share Actions -->
                        <div class="project-actions" style="margin-top: 1.5rem; display: flex; gap: 1rem;">
                            <button class="interaction-btn" id="likeBtn" onclick="toggleLike()">
                                <span>‚ù§Ô∏è</span>
                                <span id="likeText">Like</span>
                                <span id="likeCount" style="margin-left: 0.25rem;">(0)</span>
                            </button>
                            <div class="share-dropdown">
                                <button class="interaction-btn" onclick="toggleShareMenu()">
                                    <span>üì§</span>
                                    <span>Share</span>
                                </button>
                                <div class="share-menu" id="shareMenu">
                                    <div class="share-item" onclick="copyLink()">
                                        <span>üîó</span>
                                        <span>Copy Link</span>
                                    </div>
                                    <div class="share-item" onclick="shareEmail()">
                                        <span>üìß</span>
                                        <span>Share via Email</span>
                                    </div>
                                    <div class="share-item" onclick="shareTwitter()">
                                        <span>üê¶</span>
                                        <span>Share on Twitter</span>
                                    </div>
                                    <div class="share-item" onclick="shareLinkedIn()">
                                        <span>üíº</span>
                                        <span>Share on LinkedIn</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Column Container -->
                <div class="right-column">
                    <!-- Project Author Card -->
                    <div class="author-card" id="authorCard">
                        <div class="author-label">Project Author</div>
                        <div class="author-header">
                            <div class="author-avatar" id="authorAvatar">AU</div>
                            <div class="author-info">
                                <div class="author-name" id="authorName">Author Name</div>
                                <div class="author-title" id="authorTitle">Project Lead</div>
                                <a href="mailto:" class="author-email" id="authorEmail">author@dcfhungary.org</a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Related Projects Card -->
                    <div class="author-card" id="relatedProjectsCard" style="margin-top: 2rem;">
                        <div class="author-label">Related Projects</div>
                        <div id="relatedProjectsList" style="margin-top: 1rem;">
                            <!-- Related projects will be loaded here -->
                            <div style="color: #666; font-size: 0.9rem;">Loading related projects...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="stats-section" id="statsSection">
            <h3 class="stats-title" id="statsTitle">Project Statistics</h3>
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-number" id="statMembers">1</div>
                    <div class="stat-label">Members</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statTasks">0</div>
                    <div class="stat-label">Tasks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statFollowers">0</div>
                    <div class="stat-label">Followers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statFiles">0</div>
                    <div class="stat-label">Files</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statViews">0</div>
                    <div class="stat-label">Views</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statShares">0</div>
                    <div class="stat-label">Shares</div>
                </div>
            </div>

            <!-- Join Project Card -->
            <div class="join-project-card" id="joinProjectCard">
                <h3 id="joinCardTitle">Join This Project</h3>
                <p id="joinCardDescription">Help advance this important initiative and make a meaningful impact in your community</p>
                <button class="btn" id="joinProjectBtn" onclick="handleJoinProject()">ü§ù Join Now</button>
                <button class="btn manage-btn-stats" id="manageProjectBtn" onclick="manageProject()" style="display: none;">‚öôÔ∏è Manage Project</button>
            </div>
        </div>

        <!-- Two Column Layout -->
        <div style="display: grid; grid-template-columns: 300px 1fr; gap: 2rem;">
            <!-- Left Sidebar -->
            <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                <div style="background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h3 style="font-size: 1.1rem; font-weight: 600; color: #333; margin-bottom: 1rem;">Quick Actions</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <button style="background: #333; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; font-size: 0.9rem; cursor: pointer;">Create Task</button>
                        <button style="background: #f8f9fa; color: #333; border: 1px solid #e5e5e5; padding: 0.5rem 1rem; border-radius: 6px; font-size: 0.9rem; cursor: pointer;">Upload Files</button>
                        <button style="background: #f8f9fa; color: #333; border: 1px solid #e5e5e5; padding: 0.5rem 1rem; border-radius: 6px; font-size: 0.9rem; cursor: pointer;">View Analytics</button>
                    </div>
                </div>

                <div style="background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h3 style="font-size: 1.1rem; font-weight: 600; color: #333; margin-bottom: 1rem;">Project Details</h3>
                    <div style="color: #666; font-size: 0.9rem; line-height: 1.6;">
                        <p><strong>Status:</strong> Active</p>
                        <p><strong>Created:</strong> 2 weeks ago</p>
                        <p><strong>Timeline:</strong> 6 months</p>
                        <p><strong>Priority:</strong> High</p>
                    </div>
                </div>
            </div>

            <!-- Right Main Content - Project Feed -->
            <div class="project-feed-section">
                <h2 class="feed-title">Project Feed</h2>
                
                <!-- Create Post Box -->
                <div class="create-post-box">
                    <div class="post-composer">
                        <div class="composer-avatar">AU</div>
                        <textarea 
                            class="composer-textarea"
                            id="postTextArea"
                            placeholder="Share project updates, milestones, or ask the community a question..."
                            maxlength="2000"
                            oninput="updateCharacterCount()">
                        </textarea>
                    </div>

                    <div class="composer-actions">
                        <div class="upload-buttons">
                            <button class="upload-btn">üì∑ Photo</button>
                            <button class="upload-btn">üé• Video</button>
                            <button class="upload-btn">üìé Files</button>
                        </div>
                        
                        <div class="post-controls">
                            <span class="character-count" id="charCounter">0/2000</span>
                            <button class="post-btn" id="postButton" onclick="createPost()" disabled>Post</button>
                        </div>
                    </div>
                </div>
                
                <!-- Posts Container -->
                <div id="postsContainer">
                    <p style="text-align: center; color: #666; padding: 2rem;">No posts yet. Be the first to share an update!</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Cover Edit Modal -->
    <div class="cover-modal" id="coverEditModal">
        <div class="cover-modal-content">
            <div class="cover-modal-header">
                <h3>Change Cover Photo</h3>
                <button class="close-modal" onclick="closeCoverEditModal()">‚úï</button>
            </div>
            <div class="cover-modal-body">
                <div class="upload-area" id="uploadArea">
                    <input type="file" id="coverImageInput" accept="image/*" style="display: none;" onchange="previewCoverImage(event)">
                    <div class="upload-placeholder" onclick="document.getElementById('coverImageInput').click()">
                        <span style="font-size: 3rem;">üì∑</span>
                        <p>Click to upload a new cover photo</p>
                        <p style="font-size: 0.9rem; color: #666;">Recommended size: 1920x350px</p>
                    </div>
                    <img class="image-preview" id="coverImagePreview" style="display: none;">
                </div>
            </div>
            <div class="cover-modal-footer">
                <button class="btn-cancel" onclick="closeCoverEditModal()">Cancel</button>
                <button class="btn-save" onclick="saveCoverImage()" id="saveCoverBtn" disabled>Save Cover Photo</button>
            </div>
        </div>
    </div>

    <script>
        // Get project ID from URL
        function getProjectIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // Load project data
        async function loadProject() {
            const projectId = getProjectIdFromUrl();
            
            if (!projectId) {
                console.error('No project ID found in URL');
                return;
            }

            if (!window.dcfSupabase) {
                console.error('Supabase client not available');
                return;
            }

            try {
                console.log('üì• Loading project with ID:', projectId);
                
                const { data: project, error } = await window.dcfSupabase
                    .from('projects')
                    .select(`*, author:user_profiles!author_id(id,email,username,first_name,last_name,avatar_url)`)
                    .eq('id', projectId)
                    .single();

                if (error || !project) {
                    console.error('Error loading project:', error);
                    return;
                }

                // Comprehensive project data logging
                console.log('');
                console.log('üìã PROJECT DATA LOADED:');
                console.log('Full project object:', project);
                console.log('Project ID:', project.id);
                console.log('Project author_id:', project.author_id);
                console.log('Author_id type:', typeof project.author_id);
                console.log('Project author object:', project.author);
                if (project.author) {
                    console.log('  Author.id:', project.author.id);
                    console.log('  Author.id type:', typeof project.author.id);
                    console.log('  Author.email:', project.author.email);
                    console.log('  Author.username:', project.author.username);
                }
                console.log('');

                displayProject(project);
                loadRelatedProjects(project.author_id, projectId);
                
            } catch (error) {
                console.error('Error loading project:', error);
            }
        }
        
        // Load related projects by same author
        async function loadRelatedProjects(authorId, currentProjectId) {
            if (!authorId || !window.dcfSupabase) return;
            
            try {
                const { data: relatedProjects, error } = await window.dcfSupabase
                    .from('projects')
                    .select('id, title, description')
                    .eq('author_id', authorId)
                    .neq('id', currentProjectId)
                    .limit(2);  // Changed from 3 to 2
                    
                const container = document.getElementById('relatedProjectsList');
                if (!container) return;
                
                if (error || !relatedProjects || relatedProjects.length === 0) {
                    container.innerHTML = '<div style="color: #666; font-size: 0.9rem;">No other projects by this author</div>';
                    return;
                }
                
                container.innerHTML = relatedProjects.map(project => {
                    const truncatedDesc = project.description ? 
                        (project.description.length > 100 ? 
                            project.description.substring(0, 100) + '...' : 
                            project.description) : 'No description available';
                            
                    return `
                        <div class="related-project-item" onclick="window.location.href='dcf_project_detail.html?id=${project.id}'">
                            <div class="related-project-title">${project.title}</div>
                            <div class="related-project-desc">${truncatedDesc}</div>
                        </div>
                    `;
                }).join('');
                
                // Add More button at the bottom
                container.innerHTML += `
                    <button class="related-projects-more-btn" onclick="window.location.href='dcf_projects_home.html'">
                        More Projects ‚Üí
                    </button>
                `;
                
            } catch (error) {
                console.error('Error loading related projects:', error);
                const container = document.getElementById('relatedProjectsList');
                if (container) {
                    container.innerHTML = '<div style="color: #666; font-size: 0.9rem;">Error loading related projects</div>';
                }
            }
        }

        // Display project data
        async function displayProject(project) {
            // Store project globally
            window.currentProject = project;
            
            // Enhanced debugging for ownership detection
            console.log('=== OWNERSHIP DETECTION DEBUG ===');
            console.log('1. Getting current user...');
            
            // Try multiple methods to get current user
            const currentUser = window.getCurrentUser ? window.getCurrentUser() : null;
            let sessionUserId = null;
            let sessionUserEmail = null;
            
            // Also get direct from Supabase session as fallback
            if (window.dcfSupabase) {
                try {
                    const { data: { session } } = await window.dcfSupabase.auth.getSession();
                    if (session) {
                        sessionUserId = session.user.id;
                        sessionUserEmail = session.user.email;
                    }
                } catch (e) {
                    console.error('Error getting session:', e);
                }
            }
            
            console.log('2. Current User Object:', currentUser);
            console.log('3. Session User ID:', sessionUserId);
            console.log('4. Session User Email:', sessionUserEmail);
            console.log('5. Project Author ID:', project.author_id);
            console.log('6. Project Author Object:', project.author);
            
            // Try all possible ownership checks
            const checks = {
                profileIdMatch: currentUser && currentUser.id === project.author_id,
                sessionIdMatch: sessionUserId && sessionUserId === project.author_id,
                profileEmailMatch: currentUser && project.author && currentUser.email === project.author.email,
                sessionEmailMatch: sessionUserEmail && project.author && sessionUserEmail === project.author.email,
                caseInsensitiveEmail: (currentUser?.email?.toLowerCase() === project.author?.email?.toLowerCase()) ||
                                     (sessionUserEmail?.toLowerCase() === project.author?.email?.toLowerCase())
            };
            
            console.log('7. Ownership checks:', checks);
            
            // If ANY check passes, user is owner
            const isOwner = Object.values(checks).some(check => check === true);
            
            console.log('8. FINAL OWNERSHIP RESULT:', isOwner);
            console.log('=== END DEBUG ===');
            
            if (isOwner) {
                // Show edit cover button
                const editCoverBtn = document.getElementById('editCoverBtn');
                if (editCoverBtn) {
                    editCoverBtn.style.display = 'flex';
                    console.log('‚úÖ Showing edit cover button for project owner');
                }
                
                // Show owner controls (Manage Project button)
                const ownerControls = document.getElementById('ownerControls');
                if (ownerControls) {
                    ownerControls.style.display = 'flex';
                    console.log('‚úÖ Showing owner controls for project owner');
                }
                
                // Also update the stats section buttons
                const joinBtn = document.getElementById('joinProjectBtn');
                const manageBtn = document.getElementById('manageProjectBtn');
                if (joinBtn) joinBtn.style.display = 'none';
                if (manageBtn) manageBtn.style.display = 'inline-flex';
            } else {
                console.log('‚ùå User is not the project owner - controls remain hidden');
                console.log('üí° TIP: You can run forceShowOwnerControls() in console to test owner features');
            }
            
            // Set hero section - only title and goal, no description
            if (project.main_photo_url) {
                setHeroBackground(project.main_photo_url);
            }
            setHeroTitle(project.title, project.goal);
            
            // Handle website link in hero section and About section
            const websiteLink = document.getElementById('projectWebsiteLink');
            const aboutUrlLink = document.getElementById('projectUrlLink');
            
            if (project.website_url) {
                if (websiteLink) {
                    websiteLink.href = project.website_url;
                    websiteLink.style.display = 'inline-block';
                }
                
                if (aboutUrlLink) {
                    aboutUrlLink.href = project.website_url;
                    aboutUrlLink.textContent = 'Visit Project Website';
                    aboutUrlLink.style.display = 'inline-block';
                }
            } else {
                // Show fallback text when no URL is available
                if (aboutUrlLink) {
                    aboutUrlLink.removeAttribute('href');
                    aboutUrlLink.textContent = 'Project URL goes here';
                    aboutUrlLink.style.display = 'inline-block';
                    aboutUrlLink.style.color = '#999';
                    aboutUrlLink.style.cursor = 'default';
                    aboutUrlLink.style.textDecoration = 'none';
                }
            }
            
            // Set about section - use project name in title (no website link here anymore)
            setAboutContent(`About ${project.title}`, project.description, null);
            
            // Set author details using unified auth system instead of raw database data
            if (project.author) {
                const currentUser = window.getCurrentUser ? window.getCurrentUser() : null;
                
                // Check if the current user is the project author
                if (currentUser && currentUser.id === project.author_id) {
                    // Use unified auth data for current user
                    setAuthorDetails(
                        `@${currentUser.username}`,
                        'Project Lead',
                        null, // Never show email
                        generateInitials(currentUser.username),
                        currentUser.avatar_url
                    );
                } else {
                    // For other users, use only safe public data
                    const username = project.author?.username || 'Unknown User';
                    setAuthorDetails(
                        `@${username}`,
                        'Project Lead', 
                        null, // Never show email
                        generateInitials(username),
                        project.author?.avatar_url
                    );
                }
            }
            
            // Set stats (you can enhance this with actual counts later)
            setStatsData(1, 0, 0, 0, 'Project Statistics');
            
            // Check if current user is the project author and show appropriate buttons
            updateProjectButtons(project);
            
            // Update page title
            document.title = `${project.title} - DCF Hungary`;
        }

        // Function to update project buttons based on user ownership
        function updateProjectButtons(project) {
            const joinBtn = document.getElementById('joinProjectBtn');
            const manageBtn = document.getElementById('manageProjectBtn');
            const currentUser = window.getCurrentUser ? window.getCurrentUser() : null;
            
            console.log('=== UPDATE PROJECT BUTTONS DEBUG ===');
            console.log('Current User:', currentUser);
            console.log('Project Author ID:', project.author_id);
            
            // Try multiple ownership checks
            const isOwnerById = currentUser && currentUser.id === project.author_id;
            const isOwnerByEmail = currentUser && project.author && currentUser.email === project.author.email;
            const isOwner = isOwnerById || isOwnerByEmail;
            
            console.log('Ownership by ID:', isOwnerById);
            console.log('Ownership by email:', isOwnerByEmail);
            console.log('Final ownership:', isOwner);
            
            if (isOwner) {
                // User is the project owner - show manage button, hide join button
                if (joinBtn) joinBtn.style.display = 'none';
                if (manageBtn) manageBtn.style.display = 'inline-flex';
                console.log('‚úÖ Showing manage button for project owner');
            } else {
                // User is not the owner - show join button, hide manage button  
                if (joinBtn) joinBtn.style.display = 'inline-flex';
                if (manageBtn) manageBtn.style.display = 'none';
                console.log('‚ùå Showing join button for non-owner');
            }
            console.log('=== END BUTTON DEBUG ===')
        }

        // Function to handle manage project
        function manageProject() {
            const projectId = getProjectIdFromUrl();
            if (projectId) {
                window.location.href = `dcf_project_manage.html?id=${projectId}`;
            }
            }

        // Generate initials from name
        function generateInitials(name) {
            if (!name || typeof name !== 'string') return 'U';
            
            const cleanName = name.replace(/^(Dr\.?|Mr\.?|Mrs\.?|Ms\.?|Prof\.?|Professor|Father|Fr\.?|Sister|Sr\.?|Rabbi)\s+/i, '').trim();
            const parts = cleanName.split(' ').filter(part => part.length > 0);
            
            if (parts.length >= 2) {
                return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
            } else if (parts.length === 1) {
                return parts[0].substring(0, 2).toUpperCase();
            }
            
            return 'U';
        }

        // Initialize page
        async function initializePage() {
            await loadProject();
        }
        
        // Re-check ownership after authentication completes
        function recheckOwnershipAfterAuth() {
            console.log('üîÑ RE-CHECKING OWNERSHIP AFTER AUTH COMPLETION');
            
            if (!window.currentProject) {
                console.log('No project loaded yet, waiting...');
                return;
            }
            
            const currentUser = window.getCurrentUser ? window.getCurrentUser() : null;
            
            if (!currentUser) {
                console.log('Still no user after auth - may not be logged in');
                return;
            }
            
            console.log('Re-check - Current User:', currentUser);
            console.log('Re-check - User ID:', currentUser.id);
            console.log('Re-check - Project Author ID:', window.currentProject.author_id);
            
            // Check ownership
            const isOwnerById = currentUser.id === window.currentProject.author_id;
            const isOwnerByEmail = window.currentProject.author && 
                                  currentUser.email === window.currentProject.author.email;
            
            const isOwner = isOwnerById || isOwnerByEmail;
            
            console.log('Re-check - Ownership by ID:', isOwnerById);
            console.log('Re-check - Ownership by email:', isOwnerByEmail);
            console.log('Re-check - FINAL RESULT:', isOwner);
            
            if (isOwner) {
                console.log('‚úÖ OWNERSHIP CONFIRMED AFTER AUTH - SHOWING CONTROLS');
                
                // Show edit cover button
                const editCoverBtn = document.getElementById('editCoverBtn');
                if (editCoverBtn) {
                    editCoverBtn.style.display = 'flex';
                    console.log('‚úÖ Edit cover button shown');
                }
                
                // Show owner controls (Manage Project button in hero)
                const ownerControls = document.getElementById('ownerControls');
                if (ownerControls) {
                    ownerControls.style.display = 'flex';
                    console.log('‚úÖ Owner controls shown');
                }
                
                // Update stats section buttons
                const joinBtn = document.getElementById('joinProjectBtn');
                const manageBtn = document.getElementById('manageProjectBtn');
                if (joinBtn) {
                    joinBtn.style.display = 'none';
                    console.log('‚úÖ Join button hidden');
                }
                if (manageBtn) {
                    manageBtn.style.display = 'inline-flex';
                    console.log('‚úÖ Manage button shown');
                }
                
                // Also re-run updateProjectButtons for completeness
                if (typeof updateProjectButtons === 'function') {
                    updateProjectButtons(window.currentProject);
                }
            }
        }
        
        // Listen for auth completion and re-check ownership
        function setupAuthListener() {
            console.log('üéß Setting up auth completion listener');
            
            // Method 1: Check every 500ms for auth to be ready
            const authCheckInterval = setInterval(() => {
                if (window.dcfUser && window.dcfUser.isLoggedIn) {
                    console.log('‚úÖ Auth detected as complete, re-checking ownership');
                    clearInterval(authCheckInterval);
                    
                    // Give it a moment for all data to settle
                    setTimeout(() => {
                        recheckOwnershipAfterAuth();
                    }, 100);
                }
            }, 500);
            
            // Stop checking after 10 seconds
            setTimeout(() => {
                clearInterval(authCheckInterval);
            }, 10000);
            
            // Method 2: Also listen for Supabase auth state changes
            if (window.dcfSupabase) {
                window.dcfSupabase.auth.onAuthStateChange((event, session) => {
                    console.log('üîê Auth state changed:', event);
                    if (event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED' || event === 'USER_UPDATED') {
                        console.log('Auth event detected, waiting for dcfUser to update...');
                        setTimeout(() => {
                            recheckOwnershipAfterAuth();
                        }, 500);
                    }
                });
            }
        }
        
        // Like/Share Functionality
        let isLiked = false;
        let likeCount = 0;
        
        function toggleLike() {
            isLiked = !isLiked;
            const likeBtn = document.getElementById('likeBtn');
            const likeText = document.getElementById('likeText');
            const likeCountEl = document.getElementById('likeCount');
            
            if (isLiked) {
                likeBtn.classList.add('active');
                likeText.textContent = 'Liked';
                likeCount++;
            } else {
                likeBtn.classList.remove('active');
                likeText.textContent = 'Like';
                likeCount = Math.max(0, likeCount - 1);
            }
            
            likeCountEl.textContent = `(${likeCount})`;
        }
        
        function toggleShareMenu() {
            const shareMenu = document.getElementById('shareMenu');
            shareMenu.classList.toggle('active');
        }
        
        function copyLink() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                alert('Link copied to clipboard!');
                toggleShareMenu();
            });
        }
        
        function shareEmail() {
            const project = window.currentProject;
            const subject = encodeURIComponent(`Check out this project: ${project?.title || 'DCF Project'}`);
            const body = encodeURIComponent(`I thought you might be interested in this project:\n\n${project?.title || 'Project'}\n${project?.description || ''}\n\nView it here: ${window.location.href}`);
            window.open(`mailto:?subject=${subject}&body=${body}`);
            toggleShareMenu();
        }
        
        function shareTwitter() {
            const project = window.currentProject;
            const text = encodeURIComponent(`Check out this amazing project: ${project?.title || 'DCF Project'}`);
            const url = encodeURIComponent(window.location.href);
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`);
            toggleShareMenu();
        }
        
        function shareLinkedIn() {
            const url = encodeURIComponent(window.location.href);
            window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`);
            toggleShareMenu();
        }
        
        // Close share menu when clicking outside
        document.addEventListener('click', function(e) {
            const shareDropdown = e.target.closest('.share-dropdown');
            if (!shareDropdown) {
                const shareMenu = document.getElementById('shareMenu');
                if (shareMenu) {
                    shareMenu.classList.remove('active');
                }
            }
        });

        // Function to set hero background image
        function setHeroBackground(imageUrl) {
            const heroBackground = document.getElementById('heroBackground');
            if (imageUrl) {
                heroBackground.style.backgroundImage = `url(${imageUrl})`;
            }
        }

        // Function to set hero title and subtitle
        function setHeroTitle(title, subtitle) {
            const heroTitle = document.getElementById('heroTitle');
            const heroSubtitle = document.getElementById('heroSubtitle');
            
            heroTitle.textContent = title || 'Title Goes Here';
            heroSubtitle.textContent = subtitle || 'Project Goal Goes Here';
        }

        // Function to set about section content with word limit and website link
        function setAboutContent(title, description, websiteUrl) {
            const aboutTitle = document.getElementById('aboutTitle');
            const aboutDescription = document.getElementById('aboutDescription');
            const websiteLink = document.getElementById('projectWebsiteLink');
            
            if (title) {
                aboutTitle.textContent = title;
            }
            
            // Handle website link
            if (websiteUrl && websiteLink) {
                websiteLink.href = websiteUrl;
                websiteLink.style.display = 'inline-block';
            } else if (websiteLink) {
                websiteLink.style.display = 'none';
            }
            
            if (description) {
                // Save the Like/Share buttons before modifying innerHTML
                const projectActions = aboutDescription.querySelector('.project-actions');
                
                const words = description.split(' ');
                
                if (words.length > 75) {
                    const truncatedText = words.slice(0, 75).join(' ');
                    const remainingText = words.slice(75, 110).join(' '); // Max 110 words total
                    
                    aboutDescription.innerHTML = `
                        <p>
                            <span id="truncatedDesc">${truncatedText}</span>
                            <span id="fullDesc" style="display: none;">${truncatedText} ${remainingText}</span>
                            <span class="description-more" id="moreLink" onclick="showFullDescription()"> more</span>
                            <span class="description-more" id="lessLink" style="display: none;" onclick="showLessDescription()"> less</span>
                        </p>
                    `;
                } else {
                    aboutDescription.innerHTML = `<p>${description}</p>`;
                }
                
                // Re-append the Like/Share buttons after updating the description
                if (projectActions) {
                    aboutDescription.appendChild(projectActions);
                }
            }
        }

        // Function to show full description
        function showFullDescription() {
            const truncatedDesc = document.getElementById('truncatedDesc');
            const fullDesc = document.getElementById('fullDesc');
            const moreLink = document.getElementById('moreLink');
            const lessLink = document.getElementById('lessLink');
            
            if (truncatedDesc && fullDesc && moreLink && lessLink) {
                truncatedDesc.style.display = 'none';
                fullDesc.style.display = 'inline';
                moreLink.style.display = 'none';
                lessLink.style.display = 'inline';
            }
        }
        
        // Function to show less description (collapse back)
        function showLessDescription() {
            const truncatedDesc = document.getElementById('truncatedDesc');
            const fullDesc = document.getElementById('fullDesc');
            const moreLink = document.getElementById('moreLink');
            const lessLink = document.getElementById('lessLink');
            
            if (truncatedDesc && fullDesc && moreLink && lessLink) {
                truncatedDesc.style.display = 'inline';
                fullDesc.style.display = 'none';
                moreLink.style.display = 'inline';
                lessLink.style.display = 'none';
            }
        }

        // Function to set author details (privacy-safe)
        function setAuthorDetails(username, title, email, avatarInitials, avatarUrl) {
            const authorName = document.getElementById('authorName');
            const authorTitle = document.getElementById('authorTitle');
            const authorEmail = document.getElementById('authorEmail');
            const authorAvatar = document.getElementById('authorAvatar');
            
            // Debug logging
            console.log('DEBUG setAuthorDetails - avatarUrl:', avatarUrl);
            console.log('DEBUG setAuthorDetails - avatarInitials:', avatarInitials);
            console.log('DEBUG setAuthorDetails - authorAvatar element:', authorAvatar);
            
            if (username && authorName) authorName.textContent = username;
            if (title && authorTitle) authorTitle.textContent = title;
            
            // NEVER show email address - hide the email element
            if (authorEmail) {
                authorEmail.style.display = 'none';
            }
            
            // Handle avatar - use profile pic if available, otherwise initials
            if (authorAvatar) {
                if (avatarUrl) {
                    console.log('DEBUG - Setting avatar background image:', avatarUrl);
                    authorAvatar.style.backgroundImage = `url(${avatarUrl})`;
                    authorAvatar.style.backgroundSize = 'cover';
                    authorAvatar.style.backgroundPosition = 'center';
                    authorAvatar.textContent = '';
                } else {
                    authorAvatar.style.backgroundImage = '';
                    authorAvatar.style.background = 'linear-gradient(135deg, #000, #333)';
                    authorAvatar.textContent = avatarInitials || 'U';
                }
            }
        }

        // Function to set stats data
        function setStatsData(members, tasks, followers, files, views, shares) {
            console.log('=== setStatsData CALL DEBUG ===');
            console.log('Call stack:', new Error().stack);
            console.log('Parameters received:', {members, tasks, followers, files, views, shares});
            console.log('Parameter types:', {
                members: typeof members, 
                tasks: typeof tasks, 
                followers: typeof followers, 
                files: typeof files, 
                views: typeof views, 
                shares: typeof shares
            });
            
            // Force all parameters to be numbers or default values
            const safeMembers = (typeof members === 'number') ? members : 1;
            const safeTasks = (typeof tasks === 'number') ? tasks : 0;
            const safeFollowers = (typeof followers === 'number') ? followers : 0;
            const safeFiles = (typeof files === 'number') ? files : 0;
            const safeViews = (typeof views === 'number') ? views : 0;
            const safeShares = (typeof shares === 'number') ? shares : 0;
            
            console.log('Safe values:', {safeMembers, safeTasks, safeFollowers, safeFiles, safeViews, safeShares});
            
            const statMembers = document.getElementById('statMembers');
            const statTasks = document.getElementById('statTasks');
            const statFollowers = document.getElementById('statFollowers');
            const statFiles = document.getElementById('statFiles');
            const statViews = document.getElementById('statViews');
            const statShares = document.getElementById('statShares');
            
            if (statMembers) statMembers.textContent = safeMembers;
            if (statTasks) statTasks.textContent = safeTasks;
            if (statFollowers) statFollowers.textContent = safeFollowers;
            if (statFiles) statFiles.textContent = safeFiles;
            if (statViews) statViews.textContent = safeViews;
            if (statShares) statShares.textContent = safeShares;
            
            console.log('=== END setStatsData DEBUG ===');
        }

        // Function to set join card content
        function setJoinCardContent(title, description, buttonText = 'ü§ù Join Now') {
            const joinCardTitle = document.getElementById('joinCardTitle');
            const joinCardDescription = document.getElementById('joinCardDescription');
            const joinProjectBtn = document.getElementById('joinProjectBtn');
            
            if (title && joinCardTitle) joinCardTitle.textContent = title;
            if (description && joinCardDescription) joinCardDescription.textContent = description;
            if (buttonText && joinProjectBtn) joinProjectBtn.innerHTML = buttonText;
        }

        // Handle join project action
        function handleJoinProject() {
            alert('Join project functionality will be implemented here');
        }

        // Post creation functionality
        function updateCharacterCount() {
            const textArea = document.getElementById('postTextArea');
            const charCounter = document.getElementById('charCounter');
            const postButton = document.getElementById('postButton');
            
            const currentLength = textArea.value.length;
            charCounter.textContent = `${currentLength}/2000`;
            
            // Enable/disable post button
            postButton.disabled = currentLength === 0 || currentLength > 2000;
        }

        function createPost() {
            const textArea = document.getElementById('postTextArea');
            const content = textArea.value.trim();
            
            if (!content) return;
            
            // Clear the form
            textArea.value = '';
            updateCharacterCount();
            
            // Add post to container (placeholder functionality)
            const postsContainer = document.getElementById('postsContainer');
            const postHTML = `
                <div style="background: #f8f9fa; border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; border: 1px solid #e9ecef;">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #000, #333); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.8rem;">AU</div>
                        <div>
                            <div style="font-weight: 600; color: #333;">Current User</div>
                            <div style="color: #666; font-size: 0.8rem;">just now</div>
                        </div>
                    </div>
                    <div style="color: #555; line-height: 1.6;">${content}</div>
                </div>
            `;
            
            if (postsContainer.innerHTML.includes('No posts yet')) {
                postsContainer.innerHTML = postHTML;
            } else {
                postsContainer.insertAdjacentHTML('afterbegin', postHTML);
            }
            
            // Success feedback
            const postButton = document.getElementById('postButton');
            const originalText = postButton.textContent;
            postButton.textContent = 'Posted!';
            postButton.style.background = '#28a745';
            
            setTimeout(() => {
                postButton.textContent = originalText;
                postButton.style.background = '#333';
            }, 2000);
        }

        // Function to set join card content
        function setJoinCardContent(title, description, buttonText = 'ü§ù Join Now') {
            const joinCardTitle = document.getElementById('joinCardTitle');
            const joinCardDescription = document.getElementById('joinCardDescription');
            const joinProjectBtn = document.getElementById('joinProjectBtn');
            
            if (title && joinCardTitle) joinCardTitle.textContent = title;
            if (description && joinCardDescription) joinCardDescription.textContent = description;
            if (buttonText && joinProjectBtn) joinProjectBtn.innerHTML = buttonText;
        }

        // Handle join project action
        function handleJoinProject() {
            alert('Join project functionality will be implemented here');
        }

        // Post creation functionality
        function updateCharacterCount() {
            const textArea = document.getElementById('postTextArea');
            const charCounter = document.getElementById('charCounter');
            const postButton = document.getElementById('postButton');
            
            const currentLength = textArea.value.length;
            charCounter.textContent = `${currentLength}/2000`;
            
            // Enable/disable post button
            postButton.disabled = currentLength === 0 || currentLength > 2000;
        }

        function createPost() {
            const textArea = document.getElementById('postTextArea');
            const content = textArea.value.trim();
            
            if (!content) return;
            
            // Clear the form
            textArea.value = '';
            updateCharacterCount();
            
            // Add post to container (placeholder functionality)
            const postsContainer = document.getElementById('postsContainer');
            const postHTML = `
                <div style="background: #f8f9fa; border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; border: 1px solid #e9ecef;">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #000, #333); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.8rem;">AU</div>
                        <div>
                            <div style="font-weight: 600; color: #333;">Current User</div>
                            <div style="color: #666; font-size: 0.8rem;">just now</div>
                        </div>
                    </div>
                    <div style="color: #555; line-height: 1.6;">${content}</div>
                </div>
            `;
            
            if (postsContainer.innerHTML.includes('No posts yet')) {
                postsContainer.innerHTML = postHTML;
            } else {
                postsContainer.insertAdjacentHTML('afterbegin', postHTML);
            }
            
            // Success feedback
            const postButton = document.getElementById('postButton');
            const originalText = postButton.textContent;
            postButton.textContent = 'Posted!';
            postButton.style.background = '#28a745';
            
            setTimeout(() => {
                postButton.textContent = originalText;
                postButton.style.background = '#333';
            }, 2000);
        }

        // Example usage:
        // setHeroBackground('your-image-url.jpg');
        // setHeroTitle('Your Custom Title', 'Your Project Goal');
        // setAboutContent('About Our Mission', 'This project aims to make a difference...');
        // setStatsData(15, 8, 23, 5, 'Project Impact');
        // setJoinCardContent('Join Our Mission', 'Be part of something bigger than yourself');

        // Cover Edit Modal Functions
        let selectedCoverFile = null;
        
        function openCoverEditModal() {
            console.log('üé® Opening cover edit modal');
            const modal = document.getElementById('coverEditModal');
            
            if (modal) {
                console.log('‚úÖ Modal element found');
                modal.classList.add('active');
                modal.style.display = 'flex'; // Also force display flex
                console.log('Modal classes:', modal.classList.toString());
            } else {
                console.error('‚ùå Cover edit modal element not found');
            }
        }
        
        function closeCoverEditModal() {
            console.log('üîí Closing cover edit modal');
            const modal = document.getElementById('coverEditModal');
            const preview = document.getElementById('coverImagePreview');
            const placeholder = document.querySelector('.upload-placeholder');
            const saveBtn = document.getElementById('saveCoverBtn');
            const fileInput = document.getElementById('coverImageInput');
            
            if (modal) {
                modal.classList.remove('active');
                modal.style.display = 'none'; // Force hide
            }
            
            // Reset modal state
            if (preview) {
                preview.style.display = 'none';
                preview.src = '';
            }
            if (placeholder) {
                placeholder.style.display = 'block';
            }
            if (saveBtn) {
                saveBtn.disabled = true;
            }
            if (fileInput) {
                fileInput.value = ''; // Clear file input
            }
            selectedCoverFile = null;
        }
        
        function previewCoverImage(event) {
            console.log('üì∏ Preview cover image called');
            const file = event.target.files[0];
            
            if (!file) {
                console.log('No file selected');
                return;
            }
            
            console.log('File selected:', file.name, 'Type:', file.type, 'Size:', file.size);
            
            // Check file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('File size must be less than 5MB');
                event.target.value = ''; // Clear the input
                return;
            }
            
            // Check file type
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file (JPG, PNG, GIF, etc.)');
                event.target.value = ''; // Clear the input
                return;
            }
            
            selectedCoverFile = file;
            console.log('File accepted, showing preview');
            
            // Preview the image
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('coverImagePreview');
                const placeholder = document.querySelector('.upload-placeholder');
                const saveBtn = document.getElementById('saveCoverBtn');
                
                if (preview) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    console.log('‚úÖ Preview image displayed');
                }
                if (placeholder) {
                    placeholder.style.display = 'none';
                }
                if (saveBtn) {
                    saveBtn.disabled = false;
                    console.log('‚úÖ Save button enabled');
                }
            };
            reader.onerror = function(error) {
                console.error('Error reading file:', error);
                alert('Error reading file. Please try again.');
            };
            reader.readAsDataURL(file);
        }
        
        async function saveCoverImage() {
            console.log('üíæ Saving cover image');
            
            if (!selectedCoverFile) {
                alert('Please select an image first');
                return;
            }
            
            if (!window.currentProject) {
                alert('Project data not loaded. Please refresh the page.');
                return;
            }
            
            if (!window.dcfSupabase) {
                alert('Authentication system not ready. Please try again.');
                return;
            }
            
            const saveBtn = document.getElementById('saveCoverBtn');
            if (saveBtn) {
                saveBtn.disabled = true;
                saveBtn.textContent = 'Uploading...';
            }
            
            try {
                console.log('Uploading file:', selectedCoverFile.name);
                
                // Generate unique filename
                const fileExt = selectedCoverFile.name.split('.').pop();
                const fileName = `cover-${window.currentProject.id}-${Date.now()}.${fileExt}`;
                const filePath = `project-covers/${fileName}`;
                
                console.log('File path:', filePath);
                
                // Upload to Supabase Storage
                const { data: uploadData, error: uploadError } = await window.dcfSupabase.storage
                    .from('project-images')
                    .upload(filePath, selectedCoverFile, {
                        cacheControl: '3600',
                        upsert: false
                    });
                
                if (uploadError) {
                    console.error('Upload error:', uploadError);
                    // If bucket doesn't exist, try creating it or use a different bucket
                    if (uploadError.message.includes('not found')) {
                        alert('Storage bucket not configured. Please contact administrator.');
                        throw uploadError;
                    }
                    throw uploadError;
                }
                
                console.log('Upload successful:', uploadData);
                
                // Get public URL
                const { data: urlData } = window.dcfSupabase.storage
                    .from('project-images')
                    .getPublicUrl(filePath);
                
                const publicUrl = urlData.publicUrl;
                console.log('Public URL:', publicUrl);
                
                // Update project with new cover URL
                const { error: updateError } = await window.dcfSupabase
                    .from('projects')
                    .update({ main_photo_url: publicUrl })
                    .eq('id', window.currentProject.id);
                
                if (updateError) {
                    console.error('Database update error:', updateError);
                    throw updateError;
                }
                
                console.log('‚úÖ Cover photo updated in database');
                
                // Update the display
                setHeroBackground(publicUrl);
                window.currentProject.main_photo_url = publicUrl;
                closeCoverEditModal();
                
                // Show success message
                alert('Cover photo updated successfully!');
                
            } catch (error) {
                console.error('Error uploading cover:', error);
                alert(`Failed to upload cover photo: ${error.message || 'Unknown error'}`);
            } finally {
                if (saveBtn) {
                    saveBtn.disabled = false;
                    saveBtn.textContent = 'Save Cover Photo';
                }
            }
        }
        
        // Comprehensive Authorization Audit Function
        async function runAuthorizationAudit() {
            console.log('');
            console.log('üîç ============================================');
            console.log('üîç COMPREHENSIVE AUTHORIZATION AUDIT STARTING');
            console.log('üîç ============================================');
            console.log('');
            
            // 1. Check localStorage and sessionStorage
            console.log('üì¶ 1. STORAGE AUDIT:');
            console.log('localStorage items:', Object.keys(localStorage));
            console.log('sessionStorage items:', Object.keys(sessionStorage));
            
            // Check for Supabase auth data
            const authKeys = Object.keys(localStorage).filter(key => key.includes('supabase') || key.includes('auth'));
            console.log('Auth-related localStorage keys:', authKeys);
            authKeys.forEach(key => {
                try {
                    const value = localStorage.getItem(key);
                    console.log(`  ${key}:`, value ? JSON.parse(value) : 'null');
                } catch (e) {
                    console.log(`  ${key}: [non-JSON value]`);
                }
            });
            
            // 2. Check global auth objects
            console.log('');
            console.log('üåç 2. GLOBAL OBJECTS AUDIT:');
            console.log('window.dcfUser:', window.dcfUser);
            console.log('window.dcfSupabase:', window.dcfSupabase ? 'Available' : 'Not available');
            console.log('window.getCurrentUser:', typeof window.getCurrentUser);
            
            // 3. Get current user via different methods
            console.log('');
            console.log('üë§ 3. CURRENT USER RETRIEVAL:');
            
            // Method 1: Via getCurrentUser function
            const userMethod1 = window.getCurrentUser ? window.getCurrentUser() : null;
            console.log('Method 1 - getCurrentUser():', userMethod1);
            
            // Method 2: Direct from dcfUser
            const userMethod2 = window.dcfUser?.profile;
            console.log('Method 2 - window.dcfUser.profile:', userMethod2);
            
            // Method 3: From Supabase directly
            if (window.dcfSupabase) {
                try {
                    const { data: { session } } = await window.dcfSupabase.auth.getSession();
                    console.log('Method 3 - Supabase session:', session);
                    if (session) {
                        console.log('  Session user ID:', session.user.id);
                        console.log('  Session user email:', session.user.email);
                        console.log('  Session user ID type:', typeof session.user.id);
                    }
                } catch (e) {
                    console.log('Method 3 - Error getting Supabase session:', e);
                }
            }
            
            // 4. Get project data
            console.log('');
            console.log('üìã 4. PROJECT DATA AUDIT:');
            const projectId = getProjectIdFromUrl();
            console.log('Project ID from URL:', projectId);
            
            if (window.currentProject) {
                console.log('Current Project:', window.currentProject);
                console.log('  Project author_id:', window.currentProject.author_id);
                console.log('  Project author_id type:', typeof window.currentProject.author_id);
                console.log('  Project author object:', window.currentProject.author);
                if (window.currentProject.author) {
                    console.log('    Author ID:', window.currentProject.author.id);
                    console.log('    Author email:', window.currentProject.author.email);
                    console.log('    Author username:', window.currentProject.author.username);
                }
            } else {
                console.log('No current project loaded yet');
            }
            
            // 5. Comparison Analysis
            console.log('');
            console.log('üîÑ 5. COMPARISON ANALYSIS:');
            
            if (userMethod1 && window.currentProject) {
                console.log('User ID:', userMethod1.id);
                console.log('Project author_id:', window.currentProject.author_id);
                console.log('Are they equal (===)?', userMethod1.id === window.currentProject.author_id);
                console.log('Are they equal (==)?', userMethod1.id == window.currentProject.author_id);
                console.log('String comparison:', String(userMethod1.id) === String(window.currentProject.author_id));
                
                if (window.currentProject.author) {
                    console.log('');
                    console.log('Email comparison:');
                    console.log('  User email:', userMethod1.email);
                    console.log('  Author email:', window.currentProject.author.email);
                    console.log('  Emails match?', userMethod1.email === window.currentProject.author.email);
                    console.log('  Case-insensitive match?', 
                        userMethod1.email?.toLowerCase() === window.currentProject.author.email?.toLowerCase());
                }
            }
            
            // 6. Check auth state
            console.log('');
            console.log('üîê 6. AUTHENTICATION STATE:');
            console.log('Is logged in (dcfUser)?', window.dcfUser?.isLoggedIn);
            console.log('Has profile?', !!window.dcfUser?.profile);
            console.log('Has session?', !!window.dcfUser?.session);
            
            // 7. Function availability
            console.log('');
            console.log('‚öôÔ∏è 7. FUNCTION AVAILABILITY:');
            console.log('displayProject:', typeof displayProject);
            console.log('updateProjectButtons:', typeof updateProjectButtons);
            console.log('getCurrentUser:', typeof window.getCurrentUser);
            console.log('initializePage:', typeof initializePage);
            
            console.log('');
            console.log('üîç ============================================');
            console.log('üîç AUDIT COMPLETE - Check results above');
            console.log('üîç ============================================');
            console.log('');
        }
        
        // Manual owner control functions for testing
        function forceShowOwnerControls() {
            console.log('üîß FORCE SHOWING OWNER CONTROLS');
            
            const editCoverBtn = document.getElementById('editCoverBtn');
            const ownerControls = document.getElementById('ownerControls');
            const manageBtn = document.getElementById('manageProjectBtn');
            const joinBtn = document.getElementById('joinProjectBtn');
            
            if (editCoverBtn) {
                editCoverBtn.style.display = 'flex';
                console.log('‚úÖ Edit cover button shown');
            }
            
            if (ownerControls) {
                ownerControls.style.display = 'flex';
                console.log('‚úÖ Owner controls shown');
            }
            
            if (manageBtn) {
                manageBtn.style.display = 'inline-flex';
                console.log('‚úÖ Manage button shown');
            }
            
            if (joinBtn) {
                joinBtn.style.display = 'none';
                console.log('‚úÖ Join button hidden');
            }
            
            console.log('Owner controls forcefully shown - use this to test functionality');
        }
        
        // Try alternative auth comparison
        async function tryAlternativeAuth() {
            console.log('üîÑ TRYING ALTERNATIVE AUTH APPROACH');
            
            // Get fresh session from Supabase
            if (!window.dcfSupabase) {
                console.error('No Supabase client');
                return;
            }
            
            const { data: { session } } = await window.dcfSupabase.auth.getSession();
            
            if (!session) {
                console.log('No session found');
                return;
            }
            
            const currentUserId = session.user.id;
            const currentUserEmail = session.user.email;
            
            console.log('Current user ID from session:', currentUserId);
            console.log('Current user email from session:', currentUserEmail);
            
            if (window.currentProject) {
                const projectAuthorId = window.currentProject.author_id;
                const projectAuthorEmail = window.currentProject.author?.email;
                
                console.log('Project author ID:', projectAuthorId);
                console.log('Project author email:', projectAuthorEmail);
                
                // Try different comparison methods
                console.log('');
                console.log('COMPARISON RESULTS:');
                console.log('ID match (strict):', currentUserId === projectAuthorId);
                console.log('ID match (loose):', currentUserId == projectAuthorId);
                console.log('Email match:', currentUserEmail === projectAuthorEmail);
                console.log('Email match (case-insensitive):', 
                    currentUserEmail?.toLowerCase() === projectAuthorEmail?.toLowerCase());
                
                // If any match, show controls
                if (currentUserId === projectAuthorId || 
                    currentUserId == projectAuthorId ||
                    currentUserEmail === projectAuthorEmail ||
                    currentUserEmail?.toLowerCase() === projectAuthorEmail?.toLowerCase()) {
                    
                    console.log('‚úÖ MATCH FOUND - Showing owner controls');
                    forceShowOwnerControls();
                } else {
                    console.log('‚ùå No match found');
                    
                    // Log the actual values for debugging
                    console.log('');
                    console.log('DEBUG VALUES:');
                    console.log('User ID characters:', Array.from(String(currentUserId)));
                    console.log('Author ID characters:', Array.from(String(projectAuthorId)));
                }
            }
        }
        
        // Debug Edit Cover button
        function debugEditCoverButton() {
            console.log('üîç DEBUGGING EDIT COVER BUTTON');
            
            const btn = document.getElementById('editCoverBtn');
            if (!btn) {
                console.error('Button not found in DOM');
                return;
            }
            
            console.log('Button found:', btn);
            console.log('Display:', btn.style.display);
            console.log('Visibility:', btn.style.visibility);
            console.log('Opacity:', btn.style.opacity);
            console.log('Disabled:', btn.disabled);
            console.log('Pointer events:', window.getComputedStyle(btn).pointerEvents);
            console.log('Z-index:', window.getComputedStyle(btn).zIndex);
            console.log('Position:', window.getComputedStyle(btn).position);
            console.log('Current onclick:', btn.onclick);
            
            // Force show the button
            btn.style.display = 'flex';
            btn.style.visibility = 'visible';
            btn.style.opacity = '1';
            btn.disabled = false;
            btn.style.pointerEvents = 'auto';
            btn.style.zIndex = '9999';
            
            // Add a simple click handler
            btn.onclick = function() {
                alert('BUTTON CLICKED - IT WORKS!');
                console.log('Button was clicked successfully!');
                
                // Try to open the modal
                const modal = document.getElementById('coverEditModal');
                if (modal) {
                    modal.style.display = 'flex';
                    modal.classList.add('active');
                    console.log('Modal should be visible now');
                } else {
                    console.error('Modal not found');
                }
            };
            
            console.log('‚úÖ Button is now visible and clickable');
            console.log('Try clicking it now!');
        }
        
        // Make functions globally available for console testing
        window.forceShowOwnerControls = forceShowOwnerControls;
        window.runAuthorizationAudit = runAuthorizationAudit;
        window.tryAlternativeAuth = tryAlternativeAuth;
        window.recheckOwnershipAfterAuth = recheckOwnershipAfterAuth;
        window.openCoverEditModal = openCoverEditModal;
        window.closeCoverEditModal = closeCoverEditModal;
        window.previewCoverImage = previewCoverImage;
        window.saveCoverImage = saveCoverImage;
        window.debugEditCoverButton = debugEditCoverButton;
        
        // Initialize page when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM Content Loaded - Starting initialization');
            
            // Load the project first
            initializePage();
            
            // Set up auth listener to re-check ownership when auth completes
            setupAuthListener();
            
            // Setup Edit Cover button click handler
            function setupEditCoverButton() {
                const editCoverBtn = document.getElementById('editCoverBtn');
                if (!editCoverBtn) {
                    console.error('‚ùå Edit Cover button not found');
                    return;
                }
                
                console.log('üéØ Setting up Edit Cover button');
                
                // Clear any existing handlers
                editCoverBtn.onclick = null;
                const newBtn = editCoverBtn.cloneNode(true);
                editCoverBtn.parentNode.replaceChild(newBtn, editCoverBtn);
                
                // Get the fresh button reference
                const btn = document.getElementById('editCoverBtn');
                
                // Add click handler
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    console.log('üî¥ EDIT COVER BUTTON CLICKED!');
                    
                    // Show modal
                    const modal = document.getElementById('coverEditModal');
                    if (modal) {
                        console.log('Opening cover edit modal');
                        modal.style.display = 'flex';
                        modal.classList.add('active');
                    } else {
                        console.error('Cover edit modal not found');
                        alert('Cover edit modal not found. Please refresh the page.');
                    }
                });
                
                console.log('‚úÖ Edit Cover button handler attached');
            }
            
            // Call setup immediately and after delay
            setupEditCoverButton();
            setTimeout(setupEditCoverButton, 1000);
            setTimeout(setupEditCoverButton, 2000);
            
            // Run audit after a short delay to ensure everything is loaded
            setTimeout(() => {
                runAuthorizationAudit();
                
                // Also try alternative auth after audit
                setTimeout(() => {
                    tryAlternativeAuth();
                }, 500);
            }, 2000);
        });
        console.log('JavaScript parsing complete');
   </script>
</body>
</html>