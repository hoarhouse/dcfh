<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Translation System Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .test-result {
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
            margin: 5px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <h1>DCF Translation System Test</h1>
    
    <div class="test-section">
        <div class="test-title">Test 1: Check Translation Files</div>
        <div id="test1" class="test-result">Testing...</div>
    </div>
    
    <div class="test-section">
        <div class="test-title">Test 2: Language Detection</div>
        <div id="test2" class="test-result">Testing...</div>
    </div>
    
    <div class="test-section">
        <div class="test-title">Test 3: Translation Functions</div>
        <div id="test3" class="test-result">Testing...</div>
    </div>
    
    <div class="test-section">
        <div class="test-title">Test 4: Language Switching</div>
        <button onclick="testLanguageSwitch('en')">Switch to EN</button>
        <button onclick="testLanguageSwitch('it')">Switch to IT</button>
        <button onclick="testLanguageSwitch('es')">Switch to ES</button>
        <button onclick="testLanguageSwitch('hu')">Switch to HU</button>
        <div id="test4" class="test-result">Click a button to test language switching</div>
    </div>
    
    <div class="test-section">
        <div class="test-title">Test 5: LocalStorage Persistence</div>
        <div id="test5" class="test-result">Testing...</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/dcf-core.js"></script>
    <script src="js/dcf-ui.js"></script>
    
    <script>
        // Test 1: Check if translation files are accessible
        async function test1() {
            const result = document.getElementById('test1');
            try {
                const languages = ['en', 'it', 'es', 'hu'];
                const results = [];
                
                for (const lang of languages) {
                    const response = await fetch(`translations/${lang}.json`);
                    results.push(`${lang}.json: ${response.ok ? '✅' : '❌'}`);
                }
                
                result.innerHTML = results.join('<br>');
                result.className = 'test-result success';
            } catch (error) {
                result.innerHTML = 'Error: ' + error.message;
                result.className = 'test-result error';
            }
        }
        
        // Test 2: Browser language detection
        function test2() {
            const result = document.getElementById('test2');
            try {
                const browserLang = navigator.language || navigator.userLanguage;
                const detected = window.detectBrowserLanguage ? window.detectBrowserLanguage() : 'Function not available';
                
                result.innerHTML = `
                    Browser Language: ${browserLang}<br>
                    Detected Language: ${detected}<br>
                    Current Language: ${window.currentLanguage || 'Not set'}
                `;
                result.className = 'test-result success';
            } catch (error) {
                result.innerHTML = 'Error: ' + error.message;
                result.className = 'test-result error';
            }
        }
        
        // Test 3: Translation functions
        async function test3() {
            const result = document.getElementById('test3');
            try {
                // Check if functions exist
                const functions = [
                    'loadTranslations',
                    't',
                    'changeLanguage',
                    'applyTranslations',
                    'initializeTranslations'
                ];
                
                const checks = functions.map(fn => 
                    `${fn}: ${typeof window[fn] === 'function' ? '✅' : '❌'}`
                );
                
                // Test translation retrieval
                if (window.loadTranslations) {
                    await window.loadTranslations('en');
                    const testTranslation = window.t ? window.t('nav.home') : 'N/A';
                    checks.push(`Translation test (nav.home): "${testTranslation}"`);
                }
                
                result.innerHTML = checks.join('<br>');
                result.className = 'test-result success';
            } catch (error) {
                result.innerHTML = 'Error: ' + error.message;
                result.className = 'test-result error';
            }
        }
        
        // Test 4: Language switching
        async function testLanguageSwitch(lang) {
            const result = document.getElementById('test4');
            try {
                if (window.changeLanguage) {
                    await window.changeLanguage(lang);
                    result.innerHTML = `Language changed to: ${lang}<br>
                        Current language: ${window.currentLanguage}<br>
                        Test translation (nav.home): "${window.t('nav.home')}"`;
                    result.className = 'test-result success';
                } else {
                    result.innerHTML = 'changeLanguage function not available';
                    result.className = 'test-result error';
                }
            } catch (error) {
                result.innerHTML = 'Error: ' + error.message;
                result.className = 'test-result error';
            }
        }
        
        // Test 5: LocalStorage persistence
        function test5() {
            const result = document.getElementById('test5');
            try {
                const savedLang = localStorage.getItem('dcf_preferred_language');
                
                // Test setting and getting
                localStorage.setItem('dcf_preferred_language', 'test');
                const testValue = localStorage.getItem('dcf_preferred_language');
                
                // Restore original value
                if (savedLang) {
                    localStorage.setItem('dcf_preferred_language', savedLang);
                } else {
                    localStorage.removeItem('dcf_preferred_language');
                }
                
                result.innerHTML = `
                    Saved Language: ${savedLang || 'Not set'}<br>
                    LocalStorage Working: ${testValue === 'test' ? '✅' : '❌'}
                `;
                result.className = 'test-result success';
            } catch (error) {
                result.innerHTML = 'Error: ' + error.message;
                result.className = 'test-result error';
            }
        }
        
        // Run tests when page loads
        window.addEventListener('DOMContentLoaded', async () => {
            await test1();
            test2();
            await test3();
            test5();
        });
    </script>
</body>
</html>