<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Resource - DCF Hungary</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e5e5e5;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #333;
            text-decoration: none;
        }

        .logo-icon {
            width: 24px;
            height: 24px;
            background: #333;
            border-radius: 50%;
            margin-right: 8px;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-menu a {
            text-decoration: none;
            color: #666;
            font-size: 0.9rem;
            position: relative;
        }

        .nav-menu a.active {
            color: #333;
            font-weight: 600;
        }

        .nav-menu a:hover {
            color: #333;
        }

       .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            flex-shrink: 0;
        }

        .user-avatar:hover {
            transform: scale(1.05);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .user-dropdown {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            border: 1px solid #e5e5e5;
            min-width: 280px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .dropdown-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .dropdown-info {
            flex: 1;
            min-width: 0;
        }

        .dropdown-name {
            font-weight: 600;
            color: #333;
            font-size: 1rem;
            margin-bottom: 0.25rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .dropdown-email {
            color: #666;
            font-size: 0.85rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .dropdown-divider {
            height: 1px;
            background: #f0f0f0;
            margin: 0.5rem 0;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: #333;
            text-decoration: none;
            transition: all 0.2s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .dropdown-item:hover {
            background: #f8f9fa;
            color: #000;
        }

        .logout-btn {
            color: #dc3545 !important;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: #fee !important;
            color: #c82333 !important;
        }

        .dropdown-icon {
            font-size: 1rem;
            width: 20px;
            text-align: center;
            flex-shrink: 0;
        }

        .main-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .breadcrumb {
            margin-bottom: 2rem;
            color: #666;
            font-size: 0.9rem;
        }

        .breadcrumb a {
            color: #666;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            color: #333;
            text-decoration: underline;
        }

        .breadcrumb span {
            margin: 0 0.5rem;
        }

        .page-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 1rem;
        }

        .page-subtitle {
            color: #666;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .content-wrapper {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 2rem;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .sidebar-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .sidebar-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
        }

        .upload-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .upload-progress {
            background: #f8f9fa;
            border-bottom: 1px solid #e5e5e5;
            padding: 1.5rem 2rem;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 600px;
            margin: 0 auto;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
        }

        .progress-step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 15px;
            right: -50%;
            width: 100%;
            height: 2px;
            background: #e5e5e5;
            z-index: -1;
        }

        .progress-step.active::after {
            background: #333;
        }

        .progress-step.completed::after {
            background: #28a745;
        }

        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e5e5e5;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .progress-step.active .step-circle {
            background: #333;
            color: white;
        }

        .progress-step.completed .step-circle {
            background: #28a745;
            color: white;
        }

        .step-label {
            font-size: 0.8rem;
            color: #666;
            text-align: center;
        }

        .progress-step.active .step-label {
            color: #333;
            font-weight: 600;
        }

        .upload-content {
            padding: 2rem;
        }

        .upload-section {
            display: none;
        }

        .upload-section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .form-label.required::after {
            content: ' *';
            color: #dc3545;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #333;
        }

        .form-input.error {
            border-color: #dc3545;
        }

        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
        }

        .form-select:focus {
            outline: none;
            border-color: #333;
        }

        .form-select.error {
            border-color: #dc3545;
        }

        .textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 1rem;
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .textarea:focus {
            outline: none;
            border-color: #333;
        }

        .textarea.error {
            border-color: #dc3545;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-error {
            color: #dc3545;
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        .form-help {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        .file-upload {
            border: 2px dashed #e5e5e5;
            border-radius: 8px;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .file-upload:hover {
            border-color: #333;
            background: #f8f9fa;
        }

        .file-upload.dragover {
            border-color: #333;
            background: #f0f0f0;
        }

        .file-upload.has-file {
            border-color: #28a745;
            background: #f8fff8;
        }

        .file-upload.error {
            border-color: #dc3545;
            background: #fff8f8;
        }

        .upload-icon {
            font-size: 4rem;
            color: #ccc;
            margin-bottom: 1rem;
        }

        .upload-text {
            color: #666;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .upload-hint {
            color: #999;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .file-info {
            background: #f8f9fa;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .file-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-name {
            font-weight: 600;
            color: #333;
        }

        .file-size {
            color: #666;
            font-size: 0.9rem;
        }

        .file-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .btn-primary {
            background: #000;
            color: white;
        }

        .btn-primary:hover {
            background: #333;
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: transparent;
            color: #666;
            border: 2px solid #e5e5e5;
        }

        .btn-secondary:hover {
            color: #333;
            border-color: #333;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .tag-input-container {
            position: relative;
        }

        .tag-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            display: none;
        }

        .tag-suggestion {
            padding: 0.75rem;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }

        .tag-suggestion:hover {
            background: #f8f9fa;
        }

        .tag-suggestion:last-child {
            border-bottom: none;
        }

        .selected-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .tag {
            background: #f8f9fa;
            color: #333;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            border: 1px solid #e5e5e5;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tag-remove {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 0.7rem;
            padding: 0;
            margin-left: 0.25rem;
        }

        .tag-remove:hover {
            color: #dc3545;
        }

        .upload-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e5e5e5;
        }

        .action-left {
            display: flex;
            gap: 1rem;
        }

        .action-right {
            display: flex;
            gap: 1rem;
        }

        .guidelines-section {
            background: #f8f9fa;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .guidelines-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
        }

        .guidelines-list {
            list-style: none;
            padding: 0;
        }

        .guidelines-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #e5e5e5;
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .guidelines-list li:last-child {
            border-bottom: none;
        }

        .guideline-icon {
            color: #28a745;
            font-weight: 600;
        }

        .preview-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .preview-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
        }

        .preview-card {
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .preview-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .preview-icon {
            width: 50px;
            height: 50px;
            background: #333;
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .preview-icon.pdf {
            background: #dc3545;
        }

        .preview-icon.video {
            background: #007bff;
        }

        .preview-icon.presentation {
            background: #ffc107;
            color: #333;
        }

        .preview-icon.research {
            background: #6f42c1;
        }

        .preview-icon.article {
            background: #28a745;
        }

        .preview-icon.guide {
            background: #fd7e14;
        }

        .preview-info {
            flex: 1;
        }

        .preview-resource-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .preview-meta {
            color: #666;
            font-size: 0.9rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .preview-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .preview-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .success-section {
            text-align: center;
            padding: 3rem;
        }

        .success-icon {
            font-size: 4rem;
            color: #28a745;
            margin-bottom: 1rem;
        }

        .success-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
        }

        .success-message {
            color: #666;
            margin-bottom: 2rem;
        }

        .success-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .checkbox-group input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .checkbox-group label {
            cursor: pointer;
            color: #333;
            font-size: 1rem;
            font-weight: 600;
        }

        .required-confirmations {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .confirmations-title {
            color: #856404;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-align: center;
        }

        .checkbox-group-large {
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: border-color 0.3s ease;
        }

        .checkbox-group-large:hover {
            border-color: #ffc107;
        }

        .checkbox-group-large input[type="checkbox"]:checked + label {
            color: #28a745;
        }

        .checkbox-group-large input[type="checkbox"]:checked ~ .checkbox-group-large {
            border-color: #28a745;
        }

        .collection-selector {
            background: #f8f9fa;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .collection-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
        }

        .collection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .collection-option {
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .collection-option:hover {
            border-color: #333;
        }

        .collection-option.selected {
            border-color: #333;
            background: #f8f9fa;
        }

        .collection-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .collection-name {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .upload-progress-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .upload-progress-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            text-align: center;
            min-width: 300px;
        }

        .upload-progress-title {
            margin-bottom: 1rem;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .upload-progress-bar {
            background: #f0f0f0;
            border-radius: 10px;
            height: 20px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .upload-progress-fill {
            background: red;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .upload-progress-text {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        @media (max-width: 1024px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }

            .sidebar {
                order: 2;
            }

            .upload-container {
                order: 1;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 0 1rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .upload-actions {
                flex-direction: column;
                gap: 1rem;
            }

            .action-left,
            .action-right {
                width: 100%;
                justify-content: center;
            }

            .progress-steps {
                flex-direction: column;
                gap: 1rem;
            }

            .progress-step::after {
                display: none;
            }

            .nav-menu {
                display: none;
            }

            .collection-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }

            .success-actions {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-auth.js"></script>
    <script src="dcf-master-consolidated.js"></script>
</head>

<body>
    <header class="header">
        <nav class="nav-container">
            <a href="index.html" class="logo">
                <div class="logo-icon"></div>
                Domus Communis Foundation
            </a>
            <ul class="nav-menu" id="navMenu">
            </ul>
            <div class="user-menu">
                <div class="user-dropdown">
                    <div class="user-avatar" onclick="toggleUserMenu()" id="userAvatar"></div>
                    <div class="dropdown-menu" id="userDropdown">
                        <div class="dropdown-header">
                            <div class="dropdown-avatar"></div>
                            <div class="dropdown-info">
                                <div class="dropdown-name" id="dropdownUserName"></div>
                                <div class="dropdown-email" id="dropdownUserEmail"></div>
                            </div>
                        </div>
                        <!-- Navigation will be dynamically generated by dcf-master-consolidated.js -->
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="main-container">
        <div class="breadcrumb">
            <a href="dcf_member_home.html">Home</a>
            <span>></span>
            <a href="dcf_resources_library.html">Resources</a>
            <span>></span>
            <span>Upload Resource</span>
        </div>

        <div class="page-header">
            <h1 class="page-title">Share a Resource</h1>
            <p class="page-subtitle">
                Upload documents, research papers, guides, or other educational materials to share with the DCF community
            </p>
        </div>

        <div class="content-wrapper">
            <div class="sidebar">
                <div class="sidebar-card">
                    <h3 class="sidebar-title">Upload Stats</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="totalResourcesCount">-</div>
                            <div class="stat-label">Total Resources</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="myResourcesCount">-</div>
                            <div class="stat-label">My Resources</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="pendingResourcesCount">-</div>
                            <div class="stat-label">Under Review</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="approvedResourcesCount">-</div>
                            <div class="stat-label">Approved</div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-card">
                    <h3 class="sidebar-title">Quick Actions</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <!-- Quick Actions will be populated by dcf-master-consolidated.js -->
                    </div>
                </div>

                <div class="sidebar-card">
                    <h3 class="sidebar-title">Upload Tips</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                        <div style="padding: 0.75rem; background: #f8f9fa; border-radius: 8px; font-size: 0.9rem;">
                            <strong>✓ Clear Titles</strong><br>
                            <span style="color: #666;">Use descriptive, searchable titles</span>
                        </div>
                        <div style="padding: 0.75rem; background: #f8f9fa; border-radius: 8px; font-size: 0.9rem;">
                            <strong>✓ Good Tags</strong><br>
                            <span style="color: #666;">Add relevant tags for discovery</span>
                        </div>
                        <div style="padding: 0.75rem; background: #f8f9fa; border-radius: 8px; font-size: 0.9rem;">
                            <strong>✓ Quality Content</strong><br>
                            <span style="color: #666;">Ensure resources align with DCF mission</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="upload-container">
                <div class="upload-progress">
                    <div class="progress-steps">
                        <div class="progress-step active" data-step="1">
                            <div class="step-circle">1</div>
                            <div class="step-label">File Upload</div>
                        </div>
                        <div class="progress-step" data-step="2">
                            <div class="step-circle">2</div>
                            <div class="step-label">Resource Info</div>
                        </div>
                        <div class="progress-step" data-step="3">
                            <div class="step-circle">3</div>
                            <div class="step-label">Preview</div>
                        </div>
                        <div class="progress-step" data-step="4">
                            <div class="step-circle">4</div>
                            <div class="step-label">Submit</div>
                        </div>
                    </div>
                </div>

                <div class="upload-content">
                    <!-- Step 1: File Upload -->
                    <div class="upload-section active" id="step1">
                        <div class="guidelines-section">
                            <h3 class="guidelines-title">📋 Upload Guidelines</h3>
                            <ul class="guidelines-list">
                                <li>
                                    <span class="guideline-icon">✓</span>
                                    <div>All content must align with DCF's mission of ethical AI and Catholic Social Teaching</div>
                                </li>
                                <li>
                                    <span class="guideline-icon">✓</span>
                                    <div>Supported formats: PDF, DOC, DOCX, PPT, PPTX, MP4, JPG, PNG (max 50MB)</div>
                                </li>
                                <li>
                                    <span class="guideline-icon">✓</span>
                                    <div>Ensure you have permission to share the content and respect copyright</div>
                                </li>
                                <li>
                                    <span class="guideline-icon">✓</span>
                                    <div>Resources undergo review before publication to ensure quality and relevance</div>
                                </li>
                                <li>
                                    <span class="guideline-icon">✓</span>
                                    <div>Academic and research materials are especially welcome</div>
                                </li>
                            </ul>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">Resource File</label>
                            <div class="file-upload" id="fileUpload">
                                <div class="upload-icon">📁</div>
                                <div class="upload-text">Click to select file or drag and drop</div>
                                <div class="upload-hint">Supported formats: PDF, DOC, PPT, Video (MP4), Images • Max file size: 50MB</div>
                                <input type="file" id="resourceFile" style="display: none;" accept=".pdf,.doc,.docx,.ppt,.pptx,.mp4,.jpg,.jpeg,.png,.mov,.avi">
                            </div>
                            <div class="form-error" id="fileError"></div>
                        </div>

                        <div class="file-info" id="fileInfo" style="display: none;">
                            <div class="file-details">
                                <div>
                                    <div class="file-name" id="fileName"></div>
                                    <div class="file-size" id="fileSize"></div>
                                </div>
                                <div class="file-actions">
                                    <button class="btn btn-danger btn-small" onclick="removeFile()">Remove</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Resource Information -->
                    <div class="upload-section" id="step2">
                        <div class="form-group">
                            <label class="form-label required" for="resourceTitle">Resource Title</label>
                            <input type="text" id="resourceTitle" class="form-input" placeholder="Enter a descriptive title for your resource">
                            <div class="form-error" id="titleError"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required" for="resourceDescription">Description</label>
                            <textarea id="resourceDescription" class="textarea" placeholder="Provide a detailed description of the resource, its purpose, key insights, and how it relates to DCF's mission..."></textarea>
                            <div class="form-help">Be specific about the content, target audience, and potential applications</div>
                            <div class="form-error" id="descriptionError"></div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label required" for="resourceType">Resource Type</label>
                                <select id="resourceType" class="form-select">
                                    <option value="">Select resource type</option>
                                    <option value="research">Research Paper</option>
                                    <option value="guide">Guide/Toolkit</option>
                                    <option value="article">Article</option>
                                    <option value="video">Video</option>
                                    <option value="presentation">Presentation</option>
                                    <option value="report">Report</option>
                                    <option value="case-study">Case Study</option>
                                    <option value="white-paper">White Paper</option>
                                    <option value="other">Other</option>
                                </select>
                                <div class="form-error" id="typeError"></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label required" for="resourceLanguage">Language</label>
                                <select id="resourceLanguage" class="form-select">
                                    <option value="">Select language</option>
                                    <option value="en">English</option>
                                    <option value="hu">Hungarian</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                    <option value="de">German</option>
                                    <option value="it">Italian</option>
                                    <option value="pt">Portuguese</option>
                                    <option value="other">Other</option>
                                </select>
                                <div class="form-error" id="languageError"></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="resourceAuthor">Author/Creator</label>
                            <input type="text" id="resourceAuthor" class="form-input" placeholder="Original author or creator of the resource">
                            <div class="form-help">Leave blank if you are the original author</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="resourceOrganization">Organization/Institution</label>
                            <input type="text" id="resourceOrganization" class="form-input" placeholder="Organization or institution associated with this resource">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Tags</label>
                            <div class="tag-input-container">
                                <input type="text" id="resourceTags" class="form-input" placeholder="Type to add tags (e.g., AI Ethics, Education, Policy)">
                                <div class="tag-suggestions" id="tagSuggestions"></div>
                            </div>
                            <div class="selected-tags" id="selectedTags"></div>
                            <div class="form-help">Add relevant tags to help others discover your resource</div>
                        </div>

                        <div class="collection-selector">
                            <h3 class="collection-title">Add to Collection (Optional)</h3>
                            <div class="collection-grid">
                                <div class="collection-option" data-collection="ai-ethics">
                                    <div class="collection-icon">🤖</div>
                                    <div class="collection-name">AI Ethics</div>
                                </div>
                                <div class="collection-option" data-collection="catholic-social-teaching">
                                    <div class="collection-icon">⛪</div>
                                    <div class="collection-name">Catholic Social Teaching</div>
                                </div>
                                <div class="collection-option" data-collection="research-papers">
                                    <div class="collection-icon">📚</div>
                                    <div class="collection-name">Research Papers</div>
                                </div>
                                <div class="collection-option" data-collection="toolkits">
                                    <div class="collection-icon">🛠️</div>
                                    <div class="collection-name">Toolkits & Guides</div>
                                </div>
                                <div class="collection-option" data-collection="education">
                                    <div class="collection-icon">🎓</div>
                                    <div class="collection-name">Education</div>
                                </div>
                                <div class="collection-option" data-collection="policy">
                                    <div class="collection-icon">📋</div>
                                    <div class="collection-name">Policy & Governance</div>
                                </div>
                            </div>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="copyrightConfirm" required>
                            <label for="copyrightConfirm">I confirm that I have the right to share this resource and it doesn't violate any copyright laws</label>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="guidelinesConfirm" required>
                            <label for="guidelinesConfirm">I confirm that this resource aligns with DCF's mission and community guidelines</label>
                        </div>
                    </div>

                    <!-- Step 3: Preview -->
                    <div class="upload-section" id="step3">
                        <div class="preview-section">
                            <h2 class="preview-title">Resource Preview</h2>
                            <div class="preview-card" id="previewCard">
                                <div class="preview-header">
                                    <div class="preview-icon" id="previewIcon">📄</div>
                                    <div class="preview-info">
                                        <div class="preview-resource-title" id="previewTitle">Resource Title</div>
                                        <div class="preview-meta">
                                            <span id="previewAuthor">Author Name</span>
                                            <span id="previewType">Resource Type</span>
                                            <span id="previewLanguage">Language</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="preview-description" id="previewDescription">
                                    Resource description will appear here...
                                </div>
                                <div class="preview-tags" id="previewTags"></div>
                            </div>
                        </div>

                        <div class="guidelines-section">
                            <h3 class="guidelines-title">📝 Before You Submit</h3>
                            <ul class="guidelines-list">
                                <li>
                                    <span class="guideline-icon">✓</span>
                                    <div>Review all information for accuracy and completeness</div>
                                </li>
                                <li>
                                    <span class="guideline-icon">✓</span>
                                    <div>Ensure your resource is properly tagged for discoverability</div>
                                </li>
                                <li>
                                    <span class="guideline-icon">✓</span>
                                    <div>Your resource will be reviewed by DCF moderators before publication</div>
                                </li>
                                <li>
                                    <span class="guideline-icon">✓</span>
                                    <div>You'll receive notification when your resource is approved</div>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Step 4: Success -->
                    <div class="upload-section" id="step4">
                        <div class="success-section">
                            <div class="success-icon">✅</div>
                            <h2 class="success-title">Resource Submitted Successfully!</h2>
                            <p class="success-message">
                                Thank you for contributing to the DCF community. Your resource has been submitted for review and will be available in the library once approved. You'll receive an email notification when the review is complete.
                            </p>
                            <div class="success-actions">
                                <button class="btn btn-primary" onclick="window.location.href='dcf_resources_library.html'">Browse Resources</button>
                                <button class="btn btn-secondary" onclick="uploadAnother()">Upload Another</button>
                                <button class="btn btn-secondary" onclick="window.location.href='dcf_member_home.html'">Return to Dashboard</button>
                            </div>
                        </div>
                    </div>

                    <div class="upload-actions" id="navigationActions">
                        <div class="action-left">
                            <button class="btn btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">← Previous</button>
                        </div>
                        <div class="action-right">
                            <button class="btn btn-secondary" onclick="saveDraft()" id="draftBtn">Save as Draft</button>
                            <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">Next →</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let currentStep = 1;
        let selectedFile = null;
        let selectedTags = [];
        let selectedCollection = null;

        // Load statistics on page load
        async function loadUploadStats() {
            try {
                const { data: { session } } = await window.authSupabase.auth.getSession();
                if (!session?.user) return;
                const currentUser = { email: session.user.email };

                // Total resources count
                const { count: totalCount } = await window.authSupabase
                    .from('resources')
                    .select('*', { count: 'exact', head: true })
                    .eq('status', 'approved');

                // User's resources count
                const { count: myCount } = await window.authSupabase
                    .from('resources')
                    .select('*', { count: 'exact', head: true })
                    .eq('author_email', currentUser.email);

                // User's pending resources
                const { count: pendingCount } = await window.authSupabase
                    .from('resources')
                    .select('*', { count: 'exact', head: true })
                    .eq('author_email', currentUser.email)
                    .eq('status', 'pending');

                // User's approved resources
                const { count: approvedCount } = await window.authSupabase
                    .from('resources')
                    .select('*', { count: 'exact', head: true })
                    .eq('author_email', currentUser.email)
                    .eq('status', 'approved');

                // Update UI
                document.getElementById('totalResourcesCount').textContent = totalCount || 0;
                document.getElementById('myResourcesCount').textContent = myCount || 0;
                document.getElementById('pendingResourcesCount').textContent = pendingCount || 0;
                document.getElementById('approvedResourcesCount').textContent = approvedCount || 0;

            } catch (error) {
                console.error('Error loading upload stats:', error);
            }
        }

        // File upload functionality
        document.getElementById('fileUpload').addEventListener('click', function() {
            if (!selectedFile) {
                document.getElementById('resourceFile').click();
            }
        });

        document.getElementById('resourceFile').addEventListener('change', function(e) {
            handleFileSelect(e.target.files[0]);
        });

        // Drag and drop functionality
        const fileUpload = document.getElementById('fileUpload');

        fileUpload.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
        });

        fileUpload.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
        });

        fileUpload.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0]);
            }
        });

        function handleFileSelect(file) {
            // Validate file
            const maxSize = 50 * 1024 * 1024; // 50MB
            const allowedTypes = [
                'application/pdf',
                'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                'application/vnd.ms-powerpoint',
                'application/vnd.openxmlformats-officedocument.presentationml.presentation',
                'video/mp4',
                'video/mov',
                'video/avi',
                'image/jpeg',
                'image/png',
                'image/jpg'
            ];

            if (file.size > maxSize) {
                showError('fileError', 'File size must be less than 50MB');
                return;
            }

            if (!allowedTypes.includes(file.type)) {
                showError('fileError', 'Unsupported file type. Please use PDF, DOC, PPT, MP4, or image files.');
                return;
            }

            selectedFile = file;
            clearError('fileError');
            
            // Update UI
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            document.getElementById('fileInfo').style.display = 'block';
            
            // Update upload area
            const uploadArea = document.getElementById('fileUpload');
            uploadArea.classList.add('has-file');
            uploadArea.querySelector('.upload-text').textContent = `Selected: ${file.name}`;
            uploadArea.querySelector('.upload-hint').textContent = 'File ready for upload';
            
            // Auto-populate title if empty
            if (!document.getElementById('resourceTitle').value) {
                const nameWithoutExt = file.name.replace(/\.[^/.]+$/, '');
                document.getElementById('resourceTitle').value = nameWithoutExt;
            }
        }

        function removeFile() {
            selectedFile = null;
            document.getElementById('fileInfo').style.display = 'none';
            document.getElementById('resourceFile').value = '';
            
            // Reset upload area
            const uploadArea = document.getElementById('fileUpload');
            uploadArea.classList.remove('has-file');
            uploadArea.querySelector('.upload-text').textContent = 'Click to select file or drag and drop';
            uploadArea.querySelector('.upload-hint').textContent = 'Supported formats: PDF, DOC, PPT, Video (MP4), Images • Max file size: 50MB';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Tag functionality
        const tagSuggestions = [
            'AI Ethics', 'Catholic Social Teaching', 'Education', 'Research', 'Policy', 'Governance',
            'Technology', 'Human Dignity', 'Common Good', 'Transparency', 'Accountability',
            'Child Safety', 'Privacy', 'Data Protection', 'Machine Learning', 'Artificial Intelligence',
            'Theology', 'Philosophy', 'Implementation', 'Best Practices', 'Case Study',
            'Framework', 'Guidelines', 'Standards', 'Compliance', 'Innovation'
        ];

        document.getElementById('resourceTags').addEventListener('input', function(e) {
            const input = e.target.value.toLowerCase();
            const suggestions = document.getElementById('tagSuggestions');
            
            if (input.length > 0) {
                const filtered = tagSuggestions.filter(tag => 
                    tag.toLowerCase().includes(input) && !selectedTags.includes(tag)
                );
                
                if (filtered.length > 0) {
                    suggestions.innerHTML = filtered.slice(0, 5).map(tag => 
                        `<div class="tag-suggestion" onclick="addTag('${tag}')">${tag}</div>`
                    ).join('');
                    suggestions.style.display = 'block';
                } else {
                    suggestions.style.display = 'none';
                }
            } else {
                suggestions.style.display = 'none';
            }
        });

        document.getElementById('resourceTags').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ',') {
                e.preventDefault();
                const tag = e.target.value.trim();
                if (tag && !selectedTags.includes(tag)) {
                    addTag(tag);
                }
            }
        });

        function addTag(tag) {
            if (!selectedTags.includes(tag)) {
                selectedTags.push(tag);
                updateTagDisplay();
                document.getElementById('resourceTags').value = '';
                document.getElementById('tagSuggestions').style.display = 'none';
            }
        }

        function removeTag(tag) {
            selectedTags = selectedTags.filter(t => t !== tag);
            updateTagDisplay();
        }

        function updateTagDisplay() {
            const container = document.getElementById('selectedTags');
            container.innerHTML = selectedTags.map(tag => 
                `<div class="tag">
                    ${tag}
                    <button class="tag-remove" onclick="removeTag('${tag}')" type="button">×</button>
                </div>`
            ).join('');
        }

        // Collection selection
        document.querySelectorAll('.collection-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.collection-option').forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                selectedCollection = this.dataset.collection;
            });
        });

        // Step navigation
        function nextStep() {
            if (validateCurrentStep()) {
                if (currentStep < 4) {
                    currentStep++;
                    updateStep();
                }
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStep();
            }
        }

        function updateStep() {
            // Hide all sections
            document.querySelectorAll('.upload-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show current section
            document.getElementById(`step${currentStep}`).classList.add('active');
            
            // Update progress
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index + 1 === currentStep) {
                    step.classList.add('active');
                } else if (index + 1 < currentStep) {
                    step.classList.add('completed');
                }
            });
            
            // Update buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const draftBtn = document.getElementById('draftBtn');
            const navigationActions = document.getElementById('navigationActions');
            
            if (currentStep === 1) {
                prevBtn.style.display = 'none';
                nextBtn.textContent = 'Next →';
            } else if (currentStep === 4) {
                navigationActions.style.display = 'none';
            } else {
                prevBtn.style.display = 'inline-flex';
                if (currentStep === 3) {
                    nextBtn.textContent = 'Submit Resource';
                } else {
                    nextBtn.textContent = 'Next →';
                }
            }
            
            // Update preview if on step 3
            if (currentStep === 3) {
                updatePreview();
            }
            
            // Submit if on step 4
            if (currentStep === 4) {
                submitResource();
            }
        }

        function validateCurrentStep() {
            clearAllErrors();
            
            if (currentStep === 1) {
                if (!selectedFile) {
                    showError('fileError', 'Please select a file to upload');
                    return false;
                }
                return true;
            } else if (currentStep === 2) {
                let isValid = true;
                
                if (!document.getElementById('resourceTitle').value.trim()) {
                    showError('titleError', 'Please enter a resource title');
                    isValid = false;
                }
                
                if (!document.getElementById('resourceDescription').value.trim()) {
                    showError('descriptionError', 'Please provide a description');
                    isValid = false;
                }
                
                if (!document.getElementById('resourceType').value) {
                    showError('typeError', 'Please select a resource type');
                    isValid = false;
                }
                
                if (!document.getElementById('resourceLanguage').value) {
                    showError('languageError', 'Please select a language');
                    isValid = false;
                }
                
                if (!document.getElementById('copyrightConfirm').checked) {
                    showCustomAlert('Please confirm that you have the right to share this resource');
                    isValid = false;
                }
                
                if (!document.getElementById('guidelinesConfirm').checked) {
                    showCustomAlert('Please confirm that your resource aligns with DCF guidelines');
                    isValid = false;
                }
                
                return isValid;
            }
            
            return true;
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            
            // Add error styling to related input
            const inputId = elementId.replace('Error', '');
            const inputElement = document.getElementById(inputId);
            if (inputElement) {
                inputElement.classList.add('error');
            }
        }

        function clearError(elementId) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = '';
            
            // Remove error styling from related input
            const inputId = elementId.replace('Error', '');
            const inputElement = document.getElementById(inputId);
            if (inputElement) {
                inputElement.classList.remove('error');
            }
        }

        function clearAllErrors() {
            document.querySelectorAll('.form-error').forEach(error => {
                error.textContent = '';
            });
            document.querySelectorAll('.form-input, .form-select, .textarea').forEach(input => {
                input.classList.remove('error');
            });
        }

        async function updatePreview() {
            const title = document.getElementById('resourceTitle').value || 'Resource Title';
            const description = document.getElementById('resourceDescription').value || 'Resource description will appear here...';
            const type = document.getElementById('resourceType').value || 'Resource Type';
            const language = document.getElementById('resourceLanguage').value || 'Language';
            const { data: { session } } = await window.authSupabase.auth.getSession();
            const currentUserName = session?.user?.user_metadata?.name || session?.user?.email?.split('@')[0] || 'Unknown Author';
const author = document.getElementById('resourceAuthor').value || currentUserName;            
            document.getElementById('previewTitle').textContent = title;
            document.getElementById('previewDescription').textContent = description;
            document.getElementById('previewType').textContent = type.charAt(0).toUpperCase() + type.slice(1);
            document.getElementById('previewLanguage').textContent = language.toUpperCase();
            document.getElementById('previewAuthor').textContent = author;
            
            // Update preview icon based on type
            const previewIcon = document.getElementById('previewIcon');
            const iconMap = {
                'research': '🔬',
                'guide': '📄',
                'article': '📰',
                'video': '🎥',
                'presentation': '📊',
                'report': '📋',
                'case-study': '📚',
                'white-paper': '📜',
                'other': '📄'
            };
            
            previewIcon.textContent = iconMap[type] || '📄';
            previewIcon.className = `preview-icon ${type}`;
            
            // Update preview tags
            const previewTags = document.getElementById('previewTags');
            previewTags.innerHTML = selectedTags.map(tag => 
                `<div class="tag">${tag}</div>`
            ).join('');
        }

        async function submitResource() {
            try {
                const { data: { session } } = await window.authSupabase.auth.getSession();
                if (!session?.user) {
                    alert('You must be logged in to upload resources');
                    return;
                }
                const currentUser = { email: session.user.email, name: session.user.user_metadata?.name || session.user.email.split('@')[0] };

                // Show progress modal
                const progressModal = createProgressModal();
                document.body.appendChild(progressModal);

                let fileUrl = null;
                
                // Upload file to Supabase Storage if present
                if (selectedFile) {
                    updateProgress(progressModal, 10, 'Preparing file upload...');
                    
                    const fileName = `${Date.now()}-${Math.random().toString(36).substring(2)}-${selectedFile.name}`;
                    
                    updateProgress(progressModal, 30, 'Uploading file...');
                    
                    const { data: uploadData, error: uploadError } = await window.authSupabase.storage
                        .from('resource-files')
                        .upload(fileName, selectedFile);

                    if (uploadError) throw uploadError;

                    updateProgress(progressModal, 60, 'Processing file...');

                    // Get public URL
                    const { data: urlData } = window.authSupabase.storage
                        .from('resource-files')
                        .getPublicUrl(fileName);
                    
                    fileUrl = urlData.publicUrl;
                }

                updateProgress(progressModal, 80, 'Saving resource metadata...');
                
                // Debug auth info
                const { data: { user } } = await window.authSupabase.auth.getUser();
                console.log('Current user for insert:', user);
                console.log('User email:', user?.email);
                
                // Test if we can read from resources table (should work with RLS)
                const { data: testRead, error: readError } = await window.authSupabase
                    .from('resources')
                    .select('id')
                    .limit(1);
                console.log('Can read resources:', testRead, readError);
                
                // Save resource metadata to database
                const { data, error } = await window.authSupabase
                    .from('resources')
                    .insert({
                        title: document.getElementById('resourceTitle').value,
                        description: document.getElementById('resourceDescription').value,
                        file_url: fileUrl,
                        file_type: selectedFile ? selectedFile.type : null,
                        file_size: selectedFile ? selectedFile.size : null,
                        author_email: currentUser.email,
                        author_name: currentUser.name,
                        organization: document.getElementById('resourceOrganization').value || null,
                        language: document.getElementById('resourceLanguage').value,
                        type: document.getElementById('resourceType').value,
                        tags: selectedTags,
                        collection: selectedCollection,
                        status: 'pending'
                    })
                    .select();

                if (error) throw error;

                updateProgress(progressModal, 90, 'Recording analytics...');

                // Record analytics
                if (data && data[0]) {
                    await window.authSupabase
                        .from('resource_analytics')
                        .insert({
                            resource_id: data[0].id,
                            user_email: currentUser.email,
                            action_type: 'upload',
                            metadata: {
                                file_size: selectedFile ? selectedFile.size : null,
                                file_type: selectedFile ? selectedFile.type : null
                            }
                        });
                }

                updateProgress(progressModal, 100, 'Upload complete!');

                // Remove progress modal after short delay
                setTimeout(() => {
                    document.body.removeChild(progressModal);
                }, 1000);

                console.log('Resource submitted successfully:', data);
                
            } catch (error) {
                console.error('Error submitting resource:', error);
                
                // Remove progress modal
                const progressModal = document.querySelector('.upload-progress-modal');
                if (progressModal) {
                    document.body.removeChild(progressModal);
                }
                
                alert('Failed to submit resource: ' + error.message);
                currentStep = 3; // Go back to preview step
                updateStep();
            }
        }

        function createProgressModal() {
            const modal = document.createElement('div');
            modal.className = 'upload-progress-modal';
            modal.innerHTML = `
                <div class="upload-progress-content">
                    <h3 class="upload-progress-title">Uploading Resource...</h3>
                    <div class="upload-progress-bar">
                        <div class="upload-progress-fill" id="progressFill"></div>
                    </div>
                    <div class="upload-progress-text" id="progressText">0%</div>
                </div>
            `;
            return modal;
        }

        function updateProgress(modal, percent, message) {
            const fill = modal.querySelector('#progressFill');
            const text = modal.querySelector('#progressText');
            
            fill.style.width = percent + '%';
            text.textContent = message || percent + '%';
        }

        function saveDraft() {
            const draftData = {
                title: document.getElementById('resourceTitle').value,
                description: document.getElementById('resourceDescription').value,
                type: document.getElementById('resourceType').value,
                language: document.getElementById('resourceLanguage').value,
                author: document.getElementById('resourceAuthor').value,
                organization: document.getElementById('resourceOrganization').value,
                tags: selectedTags,
                collection: selectedCollection,
                step: currentStep,
                savedAt: new Date().toISOString()
            };
            
            console.log('Saving draft:', draftData);
            alert('Draft saved successfully!');
        }

        function uploadAnother() {
            // Reset form
            selectedFile = null;
            selectedTags = [];
            selectedCollection = null;
            currentStep = 1;
            
            // Clear form fields
            document.getElementById('resourceFile').value = '';
            document.getElementById('resourceTitle').value = '';
            document.getElementById('resourceDescription').value = '';
            document.getElementById('resourceType').value = '';
            document.getElementById('resourceLanguage').value = '';
            document.getElementById('resourceAuthor').value = '';
            document.getElementById('resourceOrganization').value = '';
            document.getElementById('resourceTags').value = '';
            document.getElementById('copyrightConfirm').checked = false;
            document.getElementById('guidelinesConfirm').checked = false;
            
            // Reset UI
            document.getElementById('fileInfo').style.display = 'none';
            document.getElementById('selectedTags').innerHTML = '';
            document.querySelectorAll('.collection-option').forEach(opt => opt.classList.remove('selected'));
            
            // Reset upload area
            const uploadArea = document.getElementById('fileUpload');
            uploadArea.classList.remove('has-file');
            uploadArea.querySelector('.upload-text').textContent = 'Click to select file or drag and drop';
            uploadArea.querySelector('.upload-hint').textContent = 'Supported formats: PDF, DOC, PPT, Video (MP4), Images • Max file size: 50MB';
            
            // Reset navigation
            document.getElementById('navigationActions').style.display = 'flex';
            
            updateStep();
            loadUploadStats(); // Refresh stats
        }

        // Hide tag suggestions when clicking elsewhere
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.tag-input-container')) {
                document.getElementById('tagSuggestions').style.display = 'none';
            }
        });

        function showCustomAlert(message) {
            // Remove any existing alert
            const existingAlert = document.querySelector('.custom-alert');
            if (existingAlert) {
                existingAlert.remove();
            }

            // Create custom alert
            const alertDiv = document.createElement('div');
            alertDiv.className = 'custom-alert';
            alertDiv.innerHTML = `
                <div class="custom-alert-overlay"></div>
                <div class="custom-alert-content">
                    <h3>Confirmation Required</h3>
                    <p>${message}</p>
                    <button onclick="closeCustomAlert()" class="btn btn-primary">OK</button>
                </div>
            `;

            // Add CSS if not already added
            if (!document.querySelector('#customAlertCSS')) {
                const style = document.createElement('style');
                style.id = 'customAlertCSS';
                style.textContent = `
                    .custom-alert {
                        position: fixed;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        z-index: 10000;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    }
                    .custom-alert-overlay {
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: rgba(0, 0, 0, 0.5);
                    }
                    .custom-alert-content {
                        background: white;
                        padding: 2rem;
                        border-radius: 12px;
                        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
                        text-align: center;
                        max-width: 400px;
                        width: 90%;
                        position: relative;
                        z-index: 1;
                    }
                    .custom-alert-content h3 {
                        margin-bottom: 1rem;
                        color: #333;
                        font-size: 1.2rem;
                        font-weight: 600;
                    }
                    .custom-alert-content p {
                        margin-bottom: 1.5rem;
                        color: #666;
                        line-height: 1.5;
                    }
                `;
                document.head.appendChild(style);
            }

            document.body.appendChild(alertDiv);
        }

        function closeCustomAlert() {
            const alert = document.querySelector('.custom-alert');
            if (alert) {
                alert.remove();
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateStep();
            loadUploadStats();
        });
    </script>
</body>
</html>